includes:
  - python-file: openstack_functions.py

pipelines:
  - name: check
    description: Newly uploaded patchsets enter this pipeline to receive an initial +/-1 Verified vote from the "Jenkins" user.
    success-message: Build succeeded (check pipeline).
    failure-message: Build failed (check pipeline).  For information on how to proceed, see http://docs.openstack.org/infra/manual/developers.html#automated-testing
    manager: IndependentPipelineManager
    source: gerrit
    precedence: normal
    require:
      open: True
      current-patchset: True
    trigger:
      gerrit:
        - event: patchset-created
        - event: change-restored
        - event: comment-added
          comment: (?i)^(Patch Set [0-9]+:)?( [\w\\+-]*)*(\n\n)?\s*recheck
        - event: comment-added
          require-approval:
            - Verified: [-1, -2]
              username: jenkins
          approval:
            - Workflow: 1
    success:
      gerrit:
        Verified: 1
    failure:
      gerrit:
        Verified: -1

  - name: gate
    description: Changes that have been approved by core developers are enqueued in order in this pipeline, and if they pass tests, will be merged.
    success-message: Build succeeded (gate pipeline).
    failure-message: Build failed (gate pipeline).  For information on how to proceed, see http://docs.openstack.org/infra/manual/developers.html#automated-testing
    manager: DependentPipelineManager
    source: gerrit
    precedence: high
    require:
      open: True
      current-patchset: True
      approval:
        - Verified: [1, 2]
          username: jenkins
        - Workflow: 1
    trigger:
      gerrit:
        - event: comment-added
          approval:
            - Workflow: 1
        - event: comment-added
          approval:
            - Verified: 1
          username: jenkins
    start:
      gerrit:
        Verified: 0
    success:
      gerrit:
        Verified: 2
        submit: true
    failure:
      gerrit:
        Verified: -2
    window-floor: 20
    window-increase-factor: 2

  - name: post
    description: This pipeline runs jobs that operate after each change is merged.
    manager: IndependentPipelineManager
    source: gerrit
    precedence: low
    trigger:
      gerrit:
        - event: ref-updated
          ref: ^(?!refs/).*$

  - name: release-post
    description: This pipeline runs release-process-critical jobs that operate after specific changes are merged.
    manager: IndependentPipelineManager
    source: gerrit
    precedence: high
    trigger:
      gerrit:
        - event: ref-updated
          ref: ^(?!refs/).*$
    failure:
      smtp:
        from: jenkins@openstack.org
        to: release-job-failures@lists.openstack.org
        subject: 'release-post job for {change.project} failed'

  - name: tag
    description: This pipeline runs jobs in response to any tag event.
    manager: IndependentPipelineManager
    source: gerrit
    precedence: high
    trigger:
      gerrit:
        - event: ref-updated
          ref: ^refs/tags/.*$
    failure:
      smtp:
        from: jenkins@openstack.org
        to: release-job-failures@lists.openstack.org
        subject: 'Tag of {change.project} failed'

  - name: pre-release
    description: This pipeline runs jobs on projects in response to pre-release tags.
    manager: IndependentPipelineManager
    source: gerrit
    precedence: high
    trigger:
      gerrit:
        - event: ref-updated
          ref: ^refs/tags/[0-9]+(\.[0-9]+)*(a|b|rc)[0-9]+$
    failure:
      smtp:
        from: jenkins@openstack.org
        to: release-job-failures@lists.openstack.org
        subject: 'Pre-release of {change.project} failed'

  - name: release
    description: When a commit is tagged as a release, this pipeline runs jobs that publish archives and documentation.
    manager: IndependentPipelineManager
    source: gerrit
    precedence: high
    trigger:
      gerrit:
        - event: ref-updated
          ref: ^refs/tags/[0-9]+(\.[0-9]+)*$
    failure:
      smtp:
        from: jenkins@openstack.org
        to: release-job-failures@lists.openstack.org
        subject: 'Release of {change.project} failed'

  - name: silent
    description: This pipeline is used for silently testing new jobs.
    manager: IndependentPipelineManager
    source: gerrit
    precedence: low
    trigger:
      gerrit:
        - event: patchset-created
        - event: comment-added
          comment: (?i)^(Patch Set [0-9]+:)?( [\w\\+-]*)*(\n\n)?\s*recheck

  - name: experimental
    description: On-demand pipeline for requesting a run against a set of jobs that are not yet gating. Leave review comment of "check experimental" to run jobs in this pipeline.
    success-message: Build succeeded (experimental pipeline).
    failure-message: Build failed (experimental pipeline).
    manager: IndependentPipelineManager
    source: gerrit
    precedence: normal
    trigger:
      gerrit:
        - event: comment-added
          comment: (?i)^(Patch Set [0-9]+:)?( [\w\\+-]*)*(\n\n)?\s*check experimental\s*$
    success:
      gerrit: {}
    failure:
      gerrit: {}

  - name: periodic
    description: Jobs in this queue are triggered on a timer.
    manager: IndependentPipelineManager
    source: gerrit
    precedence: low
    trigger:
      timer:
        - time: '0 6 * * *'

  - name: periodic-stable
    description: Periodic checks of the stable branches.
    manager: IndependentPipelineManager
    source: gerrit
    precedence: low
    trigger:
      timer:
        - time: '1 6 * * *'
    failure:
      smtp:
        from: jenkins@openstack.org
        to: openstack-stable-maint@lists.openstack.org
        subject: 'Stable check of {change.project} failed'

  - name: check-tripleo
    description: >
      Newly uploaded patchsets enter this pipeline to receive an initial +/-1
      Verified vote from the "Jenkins" user. This is used for TripleO patchsets only so
      that if the TripleO cloud suffers a failure, folk looking can tell that
      there isn't a system infra problem, only a TripleO specific problem.
      Once the TripleO test cloud is multi region and has some months of
      proven stability this will be folded back into the normal check pipeline.
    success-message: Build succeeded (check-tripleo pipeline).
    failure-message: >
      Build failed (check-tripleo pipeline).  For information on how to proceed, see
      http://docs.openstack.org/infra/manual/developers.html#automated-testing
    manager: IndependentPipelineManager
    source: gerrit
    precedence: normal
    require:
      open: True
      current-patchset: True
    trigger:
      gerrit:
        - event: patchset-created
        - event: change-restored
        - event: comment-added
          comment: (?i)^(Patch Set [0-9]+:)?( [\w\\+-]*)*(\n\n)?\s*recheck
    success:
      gerrit: {}
    failure:
      gerrit: {}

  - name: experimental-tripleo
    description: >
      On-demand pipeline for requesting a run against a tripleo experimental
      jobs - slower and running without redundancy - so not yet gating. Leave
      review comment of "check experimental" to run jobs in this pipeline.
    success-message: Build succeeded (experimental-tripleo).
    failure-message: Build failed (experimental-tripleo).
    manager: IndependentPipelineManager
    source: gerrit
    precedence: low
    trigger:
      gerrit:
        - event: comment-added
          comment: (?i)^(Patch Set [0-9]+:)?( [\w\\+-]*)*(\n\n)?\s*check experimental\s*$
    success:
      gerrit: {}
    failure:
      gerrit: {}

  - name: merge-check
    description: >
      Each time a change merges, this pipeline verifies that all open changes
      on the same project are still mergeable.
    failure-message: Build failed (merge-check pipeline).
    manager: IndependentPipelineManager
    ignore-dependencies: true
    source: gerrit
    precedence: low
    require:
      approval:
        - Verified: [1, 2]
          username: jenkins
    trigger:
      zuul:
        - event: project-change-merged
    merge-failure:
      gerrit:
        Verified: -1


project-templates:
  - name: merge-check
    merge-check:
      - noop

jobs:
  - name: ^.*$
    parameter-function: set_node_options
  # -nv jobs are never voting.
  - name: ^.*-nv$
    voting: false

  # Make sure we run ubuntu-trusty on master for puppet-apply.
  - name: ^gate-infra-puppet-apply-.*-ubuntu-trusty$
    branch: master

  # TODO(jaegerandi): Make voting once it passes everywhere
  - name: gate-openstackci-beaker-ubuntu-xenial
    voting: false

  # Make sure we run ubuntu-trusty on master for tempest-dsvm-lxc.
  - name: gate-tempest-dsvm-lxc-ubuntu-xenial
    branch: master

  # Make sure we run ubuntu-trusty on master for logstash-filters.
  - name: ^gate-logstash-filters-ubuntu-trusty$
    branch: master

  # Make sure we run ubuntu-trusty tests for diskimage-builder at
  # least while nodepool is a trusty host.
  - name: ^gate-dib-dsvm-functests-python2-ubuntu-trusty.*$
    branch: (master|feature/v2)

  # These projects have retained mitaka branches.  We only wish to run
  # their trusty-based jobs on Mitaka
  - name: ^gate-(python-)?group-based-policy-.*-ubuntu-trusty(-nv)?$
    branch: ^stable/mitaka
  - name: ^gate-(python-)?group-based-policy-.*-ubuntu-xenial(-nv)?$
    branch: ^(?!stable/mitaka).*$
  - name: ^gate-networking-bigswitch-.*-ubuntu-trusty(-nv)?$
    branch: ^stable/mitaka
  - name: ^gate-networking-bigswitch-.*-ubuntu-xenial(-nv)?$
    branch: ^(?!stable/mitaka).*$

  - name: ^gate-logstash-filters-ubuntu-xenial$
    voting: false

  # enable only for master and stable/pike onwards
  - name: ^gate-tempest-dsvm-monasca-transform-python-functional$
    branch: ^(?!stable/newton).*$

  # enable python35 test for master and stable/pike onwards
  - name: ^gate-tempest-dsvm-monasca-transform-python35-functional
    branch: ^(?!stable/(newton|ocata)).*$

  # OpenStack documentation process is not meant to be part of stable/ocata
  - name: ^gate-monasca(-log)?-api-releasenotes$
    branch: ^(?!stable/(newton|ocata)).*$
  - name: ^gate-monasca(-log)?-api-docs-ubuntu-xenial$
    branch: ^(?!stable/(newton|ocata)).*$

  # py35 ENV in tox were introduced recently
  # so the apply only to master and stable/ocata
  - name: ^gate-monasca-log-api-python35$
    branch: ^(?!stable/newton).*$

  # py35 for monasca-notification was introduced during Pike development
  # enable for Pike and later
  - name: ^gate-monasca-notification-python35$
    branch: ^(?!stable/(newton|ocata)).*$

  # do not run tempests on stable/newton
  # devstack gate for log-api was not functional that time
  - name: ^gate-tempest-dsvm-monasca-log-api-ubuntu-xenial$
    branch: ^(?!stable/newton).*$

  # do not run unified tempest gate on stable/(newton|ocata|pike)
  # it is meant to replace existing gate in the Queens release
  - name: ^gate-tempest-dsvm-monasca-pipeline-(logs|events)-ubuntu-xenial(-nv)?$
    branch: ^(?!stable/(newton|ocata|pike)).*$

  # because of global requirements overrides, there is no reason to
  # run tempest/grenade tests after a requirements sync, as they've
  # already been run in the requirements job with the override.
  - name: ^.*(tempest|grenade)-dsvm.*$
    skip-if:
      - project: ^openstack/
        all-files-match-any:
          - ^(test-|)requirements.txt$
          - ^setup.cfg$

  # Never have the governance validation job voting. It is strictly for
  # extra information and only run if the projects.yaml is changed
  - name: ^gate-governance-tox-validate-ubuntu-xenial$
    voting: false
    files:
      - ^reference/projects.yaml$

  - name: ^.*manila-tempest-minimal-dsvm.*$
    skip-if:
      - project: ^openstack/manila$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^manila/hacking/.*$
          - ^manila/tests/(?!.*\/dummy.py$)
          - ^releasenotes/.*$
          - ^rally-jobs/.*$
          - ^run_tests.sh$
          - ^tools/.*$
          - ^tox.ini$
          - ^api-ref/.*$
          - ^install-guide/.*$

  - name: ^.*manila-tempest-minimal-dsvm-lvm.*$
    skip-if:
      - project: ^openstack/manila$
        all-files-match-any:
          - ^manila/tests/.*$

  # Skip these long-running and expensive devstack jobs when the
  # change is only to documentation, release notes, unit tests or
  # similar components that won't be exercised by the job anyway.
  - name: ^.*(devstack|tempest|grenade|rally|cinder|keystone|keystoneclient|swift|install|neutron-lbaas|neutron-vpnaas|ironic|ironic-inspector|heat|mogan)-dsvm.*$
    skip-if:
      - project: ^openstack/cinder$
        all-files-match-any:
          - ^.*\.rst$
          - ^api-ref/.*$
          - ^doc/.*$
          - ^cinder/hacking/.*$
          - ^cinder/locale/.*$
          - ^cinder/tests/functional.*$
          - ^cinder/tests/unit.*$
          - ^contrib/block-box.*$
          - ^releasenotes/.*$
          - ^tools/.*$
          - ^tox.ini$
      - project: ^openstack/designate$
        all-files-match-any:
          - ^.*\.rst$
          - ^api-ref/.*$
          - ^doc/.*$
          - ^install-guide/.*$
          - ^designate/locale/.*$
          - ^designate/tests/.*$
          - ^releasenotes/.*$
          - ^tools/.*$
          - ^tox.ini$
      - project: ^openstack/designate-tempest-plugin$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^designate_tempest_plugin/tests/.*$
          - ^releasenotes/.*$
          - ^tools/.*$
          - ^tox.ini$
      - project: ^openstack/django_openstack_auth$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^openstack_auth/locale/.*$
          - ^openstack_auth/tests/.*$
          - ^releasenotes/.*$
          - ^tools/.*$
          - ^tox.ini$
      - project: ^openstack/python-designateclient$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^designateclient/tests/.*$
          - ^releasenotes/.*$
          - ^tools/.*$
          - ^tox.ini$
      # In heat, ^tox.ini and some scripts in ^tools/ are used
      # in heat-dsvm-functional gates, so not skipping on those changes
      - project: ^openstack/heat$
        all-files-match-any:
          - ^.*\.rst$
          - ^api-ref/.*$
          - ^doc/.*$
          - ^heat/locale/.*$
          - ^heat/tests/.*$
          - ^releasenotes/.*$
      - project: ^openstack/horizon$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^horizon/locale/.*$
          - ^horizon/test/.*$
          - ^openstack_dashboard/locale/.*$
          - ^openstack_dashboard/test/.*$
          - ^openstack_dashboard/.*/tests?\.py$
          - ^releasenotes/.*$
          - ^tools/.*$
          - ^tox.ini$
      - project: ^openstack/ironic$
        all-files-match-any:
          - ^.*\.rst$
          - ^api-ref/.*$
          - ^doc/.*$
          - ^install-guide/.*$
          - ^ironic/locale/.*$
          - ^ironic/tests/.*$
          - ^releasenotes/.*$
          - ^tools/.*$
          - ^tox.ini$
      - project: ^openstack/ironic-python-agent$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^ironic_python_agent/tests/.*$
          - ^releasenotes/.*$
          - ^tools/.*$
          - ^tox.ini$
      - project: ^openstack/ironic-inspector$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^ironic_inspector/test/(?!.*tempest).*$
          - ^releasenotes/.*$
          - ^tox.ini$
      - project: ^openstack/ironic-lib$
        all-files-match-any:
          - ^.*\.rst$
          - ^api-ref/.*$
          - ^doc/.*$
          - ^ironic_lib/tests/.*$
          - ^releasenotes/.*$
          - ^tools/.*$
          - ^tox.ini$
      - project: ^openstack/keystone$
        all-files-match-any:
          - ^.*\.rst$
          - ^api-ref/.*$
          - ^doc/.*$
          - ^etc/.*$
          - ^releasenotes/.*$
          - ^keystone/tests/unit/.*$
      - project: ^openstack/manila$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^manila/hacking/.*$
          - ^manila/tests/.*$
          - ^releasenotes/.*$
          - ^run_tests.sh$
          - ^tools/.*$
          - ^tox.ini$
          - ^api-ref/.*$
          - ^install-guide/.*$
      - project: ^openstack/mogan$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^mogan/tests/functional.*$
          - ^mogan/tests/unit.*$
          - ^releasenotes/.*$
          - ^tools/.*$
          - ^tox.ini$
          - ^api-ref/.*$
      - project: ^openstack/monasca-api
        all-files-match-any:
          - ^.*\.md$
      - project: ^openstack/neutron$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^neutron/locale/.*$
          - ^neutron/tests/unit/.*$
          - ^releasenotes/.*$
          - ^tools/.*$
          - ^tox.ini$
      - project: ^openstack/neutron-lbaas$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^neutron-lbaas/tests/unit/.*$
          - ^tools/.*$
          - ^tox.ini$
      - project: ^openstack/neutron-vpnaas$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^neutron-vpnaas/tests/unit/.*$
      - project: ^openstack/networking-odl$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$
      - project: ^openstack/networking-midonet$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^specs/.*$
          - ^midonet/neutron/tests/unit/.*$
      - project: ^openstack/networking-ovn$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$
          - ^tools/.*$
          - ^tox.ini$
          - ^vagrant/.*$
      - project: ^openstack/networking-vpp$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$
          - ^networking-vpp/tests/unit/.*$
      - project: ^openstack/nova$
        all-files-match-any:
          - ^.git.*$
          - ^.*\.rst$
          - ^doc/.*$
          - ^(placement-)?api-.*$
          - ^nova/hacking/.*$
          - ^nova/locale/.*$
          - ^nova/tests/.*$
          - ^releasenotes/.*$
          - ^tests-py3.txt$
          - ^tools/.*$
          - ^tox.ini$
      - project: ^openstack/glance$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^api-ref/.*$
          - ^releasenotes/.*$
          - ^tox.ini$
      - project: ^openstack/rally
        all-files-match-any:
          - ^doc/.*$
          - ^etc/.*$
          - ^tests/hacking/.*$
          - ^tests/unit/.*$
          - ^tox.ini$
          - ^.*\.rst$
          - ^Dockerfile$
      - project: ^openstack/swift$
        all-files-match-any:
          - ^api-ref/.*$
          - ^doc/.*$
          - ^install-guide/.*$
          - ^releasenotes/.*$
          - ^test/unit/.*$
      - project: ^openstack/tap-as-a-service
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^specs/.*$
          - ^neutron_taas/tests/unit/.*$
      - project: ^openstack/tempest$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^etc/.*$
          - ^tempest/tests/.*$
          - ^tempest/hacking/.*$
          - ^releasenotes/.*$
      - project: ^openstack/tempest-lib$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^tempest_lib/tests/.*$
          - ^releasenotes/.*$
      - project: ^openstack-dev/devstack$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
      - project: ^openstack-dev/grenade$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$

  # Skip these long-running and expensive jobs when the
  # change is only to documentation, release notes, unit tests or
  # similar components that won't be exercised by the job anyway
  # in Cinder.
  - name: ^gate-cinder-(tox-(compliance|bandit-baseline|functional)|pylint)-ubuntu.*$
    skip-if:
      - project: ^openstack/cinder$
        all-files-match-any:
          - ^.*\.rst$
          - ^api-ref/.*$
          - ^doc/.*$
          - ^cinder/hacking/.*$
          - ^cinder/locale/.*$
          - ^cinder/tests/unit.*$
          - ^contrib/block-box.*$
          - ^releasenotes/.*$

  # Skip non-doc/linter jobs for doc-only changes
  - name: ^.*openstack-helm-(aio|multi)-.*$
    skip-if:
      - project: ^openstack/openstack-helm.*$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$

  # Skip non-doc jobs for doc-only or translation-only neutron
  # changes. Since doc/source/conf.py is checked by
  # neutron-(pep8|pylint), those jobs should not be skipped.
  - name: ^.*neutron-((dsvm-api|dsvm-fullstack|dsvm-fullstack-python35|dsvm-functional|dsvm-functional-python35|python(27|35))(-ubuntu-.*)?|coverage-.+|lbaasv[12]-dsvm-(api|minimal))$
    skip-if:
      - project: ^openstack/neutron$
        all-files-match-any:
          - ^neutron/locale/.*$
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$
  # Skip non docs jobs for doc-only neutronclient changes
  - name: ^gate-(python-neutronclient-(python27|python35(-nv)?|pypy)|neutronclient-test-dsvm-functional|neutronclient-test-dsvm-functional-adv-svcs|tempest-dsvm-neutron-src-python-neutronclient)(-ubuntu-xenial)?$
    skip-if:
      - project: ^openstack/python-neutronclient$
        all-files-match-any:
          - ^neutron/locale/.*$
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$
  # Skip non-doc jobs for doc-only neutron-lib changes.
  - name: ^.*(neutron-lib-(python(27|35(-nv)?)|coverage)|tempest-dsvm-neutron-src-neutron-lib)(-ubuntu-xenial)?$
    skip-if:
      - project: ^openstack/neutron-lib$
        all-files-match-any:
          - ^.*\.rst$
          - ^api-ref/.*$
          - ^doc/.*$
          - ^releasenotes/.*$
  # Skip non-doc jobs for doc-only neutron-vpnaas changes. The dsvm
  # tests area already skipped by another check.
  - name: ^.*neutron-vpnaas-python(27|35(-nv)?)$
    skip-if:
      - project: ^openstack/neutron-vpnaas$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$
  # Skip heat docs for release notes and translation
  - name: ^.*heat-docs.*$
    skip-if:
      - project: ^openstack/heat$
        all-files-match-any:
          - ^heat/locale/.*$
          - ^releasenotes/.*$
  # Skip non-doc jobs for doc-only or translation-only nova changes.
  # Since doc/source/conf.py is checked by nova-(pep8|pylint), those
  # jobs should not be skipped.
  - name: ^.*nova-(tox-functional|python27|python35(-nv)?)
    skip-if:
      - project: ^openstack/nova$
        all-files-match-any:
          - ^.*\.rst$
          - ^api-.*$
          - ^placement-api-ref/.*$
          - ^doc/source/.*$
          - ^nova/locale/.*$
          - ^releasenotes/.*$

  - name: ^.*glance-(python27-ubuntu-xenial|python35(-nv)?)
    skip-if:
      - project: ^openstack/glance$
        all-files-match-any:
          - ^.*\.rst$
          - ^api-ref/.*$
          - ^doc/.*$
          - ^releasenotes/.*$

  - name: ^.*cinder-(python27-ubuntu-xenial|python35)
    skip-if:
      - project: ^openstack/cinder$
        all-files-match-any:
          - ^.*\.rst$
          - ^api-ref/.*$
          - ^doc/.*$
          - ^cinder/hacking/.*$
          - ^releasenotes/.*$
          - ^cinder/locale/.*$
          - ^contrib/block-box.*$
          - ^releasenotes/.*$
          - ^tools/.*$

  - name: ^.*keystone-(python27-ubuntu-xenial|python35|coverage-ubuntu-xenial)$
    skip-if:
      - project: ^openstack/keystone$
        all-files-match-any:
          - ^.*\.rst$
          - ^api-ref/.*$
          - ^doc/.*$
          - ^etc/.*$
          - ^releasenotes/.*$

  # Skip non-doc jobs for doc-only or translation-only heat changes.
  # Since doc/source/* is checked by heat-pep8, this job should not be
  # skipped.
  - name: ^.*heat-(python27-ubuntu-xenial|python35)(-nv)?$
    skip-if:
      - project: ^openstack/heat$
        all-files-match-any:
          - ^.*\.rst$
          - ^api-ref/.*$
          - ^doc/.*$
          - ^heat/locale/.*$
          - ^releasenotes/.*$
  # Skip non-doc jobs for doc-only or translation-only horizon
  # changes. Since doc/source/* is checked by horizon-pep8, this job
  # should not be skipped.
  - name: ^.*horizon-(python(27|35)|tox-py27dj.*|nodejs4-npm-run-.*|selenium-headless|dsvm-tempest-plugin)(-ubuntu-.*)?(-nv)?$
    skip-if:
      - project: ^openstack/horizon$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^horizon/locale/.*$
          - ^openstack_dashboard/locale/.*$
          - ^releasenotes/.*$
  # Skip non-doc jobs for doc-only ironic changes. Since documents are checked
  # by ironic-pep8 it should not be skipped.
  - name: ^.*ironic-(python27-ubuntu-xenial|python35)(-nv)?$
    skip-if:
      - project: ^openstack/ironic$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
  - name: ^.*ironic-inspector-(python27|python35|tox-func3?)(-ubuntu-.*)?(-nv)?$
    skip-if:
      - project: ^openstack/ironic-inspector$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
  # Skip non-doc jobs for doc-only python-ironicclient changes. Since documents
  # are checked by python-ironicclient-pep8 it should not be skipped.
  - name: ^gate-(python-ironicclient-(python27|python35(-nv)?|pypy)|ironicclient-dsvm-functional|tempest-dsvm-python-ironicclient-src)(-ubuntu-.*)?$
    skip-if:
      - project: ^openstack/python-ironicclient$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$

  # Skip non-doc jobs for doc-only python-ironic-inspector-client changes. Since documents
  # are checked by python-ironic-inspector-client-pep8 it should not be skipped.
  - name: ^gate-(python-ironic-inspector-client-(python27|python35|tox-func(-nv)?)|tempest-dsvm-python-ironic-inspector-client)(-ubuntu-.*)?$
    skip-if:
      - project: ^openstack/python-ironic-inspector-client$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$

  # Skip non-doc jobs for doc-only bifrost changes. Since documents
  # are checked by bifrost-pep8, that job should not be skipped.
  - name: ^.*bifrost-(python27|integration-tinyipa|integration-dibipa-debian|integration-dhcp)-(ubuntu-xenial|opensuse-423|centos-7)(-nv)?$
    skip-if:
      - project: ^openstack/bifrost$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$

  # temporarily set centos tinyipa job to non voting
  - name: gate-bifrost-integration-tinyipa-centos-7
    voting: false

  # Skip non-doc jobs for doc-only python-tripleoclient changes. Since documents
  # are checked by python-tripleoclient-pep8 it should not be skipped.
  # Tripleo-ci gate jobs are disabled for docs-only patches elsewhere.
  - name: ^gate-python-tripleoclient-(python27-ubuntu-xenial|python35)$
    skip-if:
      - project: ^openstack/python-tripleoclient$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
  # Skip non-doc jobs for doc-only tripleo-common changes. Since documents
  # are checked by tripleo-common-pep8 it should not be skipped.
  # Tripleo-ci gate jobs are disabled for docs-only patches elsewhere.
  - name: ^gate-tripleo-common-(python27-ubuntu-xenial|python35)$
    skip-if:
      - project: ^openstack/tripleo-common$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$

  # Python 3 jobs weren't passing on the newton branch of os-net-config
  - name: ^gate-os-net-config-python35$
    branch: ^(?!stable/newton).*$

  # TripleO 3-nodes job has been introduced in Ocata
  - name: ^gate-tripleo-ci-centos-7-3nodes.*$
    branch: ^(?!stable/newton).*$

  # tripleo scenario001 started to be used used in newton
  - name: ^gate-tripleo-ci-centos-7-scenario001-multinode-oooq-puppet.*$
    skip-if:
      - project: ^openstack/puppet-.*$
        all-files-match-any:
          - ^.*\.md$
          - ^releasenotes/.*$
          - ^metadata.json$
          - ^spec/.*$
          - ^test-requirements.txt$

  # no need to run this functional test job for documentation
  # or release notes.
  - name: ^gate-tripleo-buildimage-overcloud-full-centos-.*$
    skip-if:
      - project: ^openstack/python-tripleoclient$
        all-files-match-any:
          - ^.*\.rst$
          - ^releasenotes/.*$

  # tripleo scenario002 started to be used used in ocata
  - name: ^gate-tripleo-ci-centos-7-scenario002-multinode-oooq-puppet.*$
    branch: ^(?!stable/newton).*$
    skip-if:
      - project: ^openstack/puppet-.*$
        all-files-match-any:
          - ^.*\.md$
          - ^releasenotes/.*$
          - ^metadata.json$
          - ^spec/.*$
          - ^test-requirements.txt$

  # tripleo scenario003 started to be used used in ocata
  - name: ^gate-tripleo-ci-centos-7-scenario003-multinode-oooq-puppet.*$
    branch: ^(?!stable/newton).*$
    skip-if:
      - project: ^openstack/puppet-.*$
        all-files-match-any:
          - ^.*\.md$
          - ^releasenotes/.*$
          - ^metadata.json$
          - ^spec/.*$
          - ^test-requirements.txt$

  # tripleo scenario004 started to be used used in ocata
  - name: ^gate-tripleo-ci-centos-7-scenario004-multinode-oooq-puppet.*$
    branch: ^(?!stable/newton).*$
    skip-if:
      - project: ^openstack/puppet-.*$
        all-files-match-any:
          - ^.*\.md$
          - ^releasenotes/.*$
          - ^metadata.json$
          - ^spec/.*$
          - ^test-requirements.txt$

  # tripleo scenario007 started to be used used in pike
  - name: ^gate-tripleo-ci-centos-7-scenario007-multinode-oooq-puppet(-nv)?$
    branch: ^(?!stable/(newton|ocata)).*$
    skip-if:
      - project: ^openstack/puppet-.*$
        all-files-match-any:
          - ^.*\.md$
          - ^releasenotes/.*$
          - ^metadata.json$
          - ^spec/.*$
          - ^test-requirements.txt$

  # NOTE(emilien): zuul v2 does not allow us to specify files rules for specific projects
  # and are global to the jobname.
  # It will be done with zuul v3:
  # http://specs.openstack.org/openstack-infra/infra-specs/specs/zuulv3.html#jobs
  - name: ^gate-tripleo-ci-centos-7-scenario001-multinode(-oooq)?(-container)?(-upgrades)?(-nv)?$
    files:
      - ^(docker|puppet)/services/glance.*$
      - ^manifests/profile/base/glance.*$
      - ^manifests/haproxy.*$
      - ^(docker|puppet)/services/aodh.*$
      - ^manifests/profile/base/aodh.*$
      - ^(docker|puppet)/services/ceilometer.*$
      - ^manifests/profile/base/ceilometer.*$
      - ^(docker|puppet)/services/gnocchi.*$
      - ^manifests/profile/base/gnocchi.*$
      - ^(docker|puppet)/services/panko.*$
      - ^manifests/profile/base/panko.*$
      - ^(docker|puppet)/services/ceph.*$
      - ^manifests/profile/base/ceph.*$
      - ^manifests/profile/base/monitoring.*$
      - ^(docker|puppet)/services/monitoring.*$
      - ^manifests/profile/base/metrics.*$
      - ^(docker|puppet)/services/metrics.*$
      - ^manifests/profile/base/logging.*$
      - ^(docker|puppet)/services/logging.*$
      - ^(docker|puppet)/services/tacker.*$
      - ^manifests/profile/base/tacker.*$
      - ^(docker|puppet)/services/congress.*$
      - ^manifests/profile/base/congress.*$
      - ^(docker|puppet)/services/cinder.*$
      - ^manifests/profile/base/cinder.*$
      - ci/environments/scenario001.*$
      - ci/pingtests/scenario001.*$
      - config/general_config/featureset005.yml
      - config/general_config/featureset012.yml
      - config/general_config/featureset016.yml
      - workbooks/ceph-ansible.yaml
      - ^container-images/.*$
      - ^environments\/.*.yaml
  - name: ^gate-tripleo-ci-centos-7-scenario002-multinode(-oooq)?(-container)?(-upgrades)?(-nv)?$
    files:
      - ^(docker|puppet)/services/glance.*$
      - ^manifests/profile/base/glance.*$
      - ^manifests/haproxy.*$
      - ^(docker|puppet)/services/barbican.*$
      - ^manifests/profile/base/barbican.*$
      - ^(docker|puppet)/services/cinder.*$
      - ^manifests/profile/base/cinder.*$
      - ^(docker|puppet)/services/ec2-api.*$
      - ^manifests/profile/base/nova/ec2.*$
      - ^(docker|puppet)/services/swift.*$
      - ^manifests/profile/base/swift.*$
      - ^(docker|puppet)/services/zaqar.*$
      - ^manifests/profile/base/zaqar.*$
      - ^(docker|puppet)/services/aodh.*$
      - ^manifests/profile/base/aodh.*$
      - ^(docker|puppet)/services/ceilometer.*$
      - ^manifests/profile/base/ceilometer.*$
      - ^(docker|puppet)/services/gnocchi.*$
      - ^manifests/profile/base/gnocchi.*$
      - ^(docker|puppet)/services/panko.*$
      - ^manifests/profile/base/panko.*$
      - ci/environments/scenario002.*$
      - ci/pingtests/scenario002.*$
      - config/general_config/featureset006.yml
      - config/general_config/featureset013.yml
      - config/general_config/featureset017.yml
      - ^container-images/.*$
      - ^environments\/.*.yaml
  - name: ^gate-tripleo-ci-centos-7-scenario003-multinode(-oooq)?(-container)?(-upgrades)?(-nv)?$
    files:
      - ^(docker|puppet)/services/glance.*$
      - ^manifests/profile/base/glance.*$
      - ^manifests/haproxy.*$
      - ^(docker|puppet)/services/sahara.*$
      - ^manifests/profile/base/sahara.*$
      - ^(docker|puppet)/services/mistral.*$
      - ^manifests/profile/base/mistral.*$
      - ci/environments/scenario003.*$
      - ci/pingtests/scenario003.*$
      - config/general_config/featureset007.yml
      - config/general_config/featureset014.yml
      - config/general_config/featureset018.yml
      - roles\/(.+\/)
      - toci-quickstart\/(config|playbooks)\/(.+)
      - toci_.+
      - ^container-images/.*$
      - ^environments\/.*.yaml
  - name: ^gate-tripleo-ci-centos-7-scenario004-multinode(-oooq)?(-container)?(-upgrades)?(-nv)?$
    branch: ^(?!stable/newton).*$
    files:
      - ^(docker|puppet)/services/glance.*$
      - ^manifests/profile/base/glance.*$
      - ^manifests/haproxy.*$
      - ^(docker|puppet)/services/ceph.*$
      - ^manifests/profile/base/ceph.*$
      - ^(docker|puppet)/services/manila.*$
      - ^manifests/profile/base/manila.*$
      - ^manifests/profile/pacemaker/manila.*$
      - ci/environments/scenario004.*$
      - ci/pingtests/scenario004.*$
      - config/general_config/featureset008.yml
      - config/general_config/featureset015.yml
      - config/general_config/featureset019.yml
      - workbooks/ceph-ansible.yaml
      - ^container-images/.*$
      - ^environments\/.*.yaml
  - name: ^gate-tripleo-ci-centos-7-scenario005-multinode(-oooq)?(-nv)?$
    branch: ^(?!stable/newton).*$
    files:
      - ^manifests/haproxy.*$
      - ^(docker|puppet)/services/pacemaker.*$
      - ^manifests/pacemaker/.*$
      - ^manifests/profile/pacemaker.*$
      - manifests/profile/base/pacemaker.pp
      - ci/environments/scenario005-multinode.yaml
      - ci/pingtests/scenario005-multinode.yaml
      - config/general_config/featureset009.yml
  - name: ^gate-tripleo-ci-centos-7-scenario006-multinode(-oooq)?(-nv)?$
    branch: ^(?!stable/(newton|ocata)).*$
    files:
      - ^coe/kubernetes.*$
      - ^environments/kubernetes.*$
      - ci/environments/scenario006-multinode.yaml
      - ci/pingtests/scenario006-multinode.yaml
      - config/general_config/featureset026.yml
  - name: ^gate-tripleo-ci-centos-7-scenario007-multinode-oooq(-nv)?$
    branch: ^(?!stable/(newton|ocata)).*$
    files:
      - ci/environments/scenario007-multinode.yaml
      - ci/pingtests/scenario007-multinode.yaml
      - ^puppet/services/.*ovn.*$
      - ^manifests/profile/base/neutron/plugins/ml2/ovn.*$
      - ^manifests/profile/base/neutron/agents/ovn.*$
      - ^manifests/profile/base/neutron/ovn.*$
      - config/general_config/featureset028.yml
  - name: ^gate-tripleo-ci-centos-7-scenario007-multinode-oooq-container(-nv)?$
    branch: ^(?!stable/(newton|ocata)).*$
    files:
      - ci/environments/scenario007-multinode-containers.yaml
      - ci/pingtests/scenario007-multinode.yaml
      - ^(docker|puppet)/services/.*ovn.*$
      - ^manifests/profile/pacemaker/ovn.*$
      - ^manifests/profile/base/neutron/plugins/ml2/ovn.*$
      - ^manifests/profile/base/neutron/agents/ovn.*$
      - ^manifests/profile/base/neutron/ovn.*$
      - config/general_config/featureset030.yml
      - ^container-images/.*$
      - ^environments\/.*.yaml
  - name: ^gate-tripleo-ci-centos-7-scenario008-multinode(-oooq)?(-nv)?$
    branch: ^(?!stable/(newton|ocata)).*$
    files:
      - ^environments/.*opendaylight.*$
      - ^puppet/services/.*opendaylight.*$
      - manifests/profile/base/neutron/opendaylight.pp
      - manifests/profile/base/neutron/plugins/ml2/opendaylight.pp
      - manifests/profile/base/neutron/plugins/ovs/opendaylight.pp
      - ^manifests/profile/base/neutron/opendaylight/.*$
      - ci/environments/scenario008-multinode.yaml
      - ci/pingtests/scenario008-multinode.yaml
      - config/general_config/featureset031.yml
  - name: ^gate-tripleo-ci-centos-7-scenario009-multinode(-oooq)?(-nv)?$
    branch: ^(?!stable/(newton|ocata)).*$
    files:
      - ^coe/openshift.*$
      - ^environments/openshift.*$
      - ci/environments/scenario009-multinode.yaml
      - ci/pingtests/scenario009-multinode.yaml
      - config/general_config/featureset033.yml

  # TripleO Upgrade job has been introduced in Ocata
  - name: ^gate-tripleo-ci-centos-7.*-upgrades.*$
    branch: ^(?!stable/newton).*$

  # TripleO container jobs have been introduced in Pike
  - name: ^gate-tripleo-ci-centos-7-.*container.*$
    branch: ^(?!stable/(newton|ocata)).*$

  # TripleO Upgrade jobs are voting for scenario001,002,003 and
  # classic multinode-upgrades job on Ocata.
  # For now, we only want these jobs on stable/ocata in check & gate
  - name: ^gate-tripleo-ci-centos-7(-scenario00(1|2|3))?-multinode-upgrades$
    branch: ^stable/ocata$

  # Test TripleO stable/newton in Puppet OpenStack CI
  - name: ^gate-tripleo-ci-centos-7-ovb-1ctlr_1comp_1ceph-featureset024-puppet-newton$
    branch: ^(stable/newton).*$

  # Test TripleO stable/ocata in Puppet OpenStack CI
  - name: ^gate-tripleo-ci-centos-7-ovb-1ctlr_1comp_1ceph-featureset024-puppet-ocata$
    branch: ^(stable/ocata).*$

  # Test TripleO stable/pike in Puppet OpenStack CI
  - name: ^gate-tripleo-ci-centos-7-ovb-1ctlr_1comp_1ceph-featureset024-puppet-pike$
    branch: ^(stable/pike).*$

  # Skip non-doc jobs for doc-only networking-odl changes.  Since
  # doc/source/conf.py is checked by networking-odl-pep8, that job
  # should not be skipped.
  - name: ^.*networking-odl-(python27|python35|fullstack|functional|coverage).*$
    skip-if:
      - project: ^openstack/networking-odl$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$

  # Skip non-doc jobs for doc-only networking-midonet changes.  Since
  # doc/source/conf.py is checked by networking-midonet-pep8, that job
  # should not be skipped.
  - name: ^.*networking-midonet-(python27-ubuntu-xenial|python35(-nv)?)$
    skip-if:
      - project: ^openstack/networking-midonet$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
  # Skip non-doc jobs for doc-only magnum changes.  Since
  # doc/source/conf.py is checked by gate-magnum-pep8, that job
  # should not be skipped.
  - name: ^gate-magnum-python(27|35(-nv)?)$
    skip-if:
      - project: ^openstack/magnum$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
  # Skip non-doc jobs for doc-only tap-as-a-service changes.  Since
  # doc/source/conf.py is checked by tap-as-a-service-pep8, that job
  # should not be skipped.
  - name: ^.*tap-as-a-service-(python27-ubuntu-xenial|python35(-nv)?)$
    skip-if:
      - project: ^openstack/tap-as-a-service$
        all-files-match-any:
          - ^.*\.rst$
          - ^specs/.*$
          - ^doc/.*$
  # skip expensive dib jobs for docs changes; readme's are rst files,
  # and doc/*
  - name: ^.*dib-dsvm-functests-.*$
    skip-if:
      - project: ^openstack/diskimage-builder$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
  - name: ^.*diskimage-builder-(python27-ubuntu-xenial|python35(-nv)?)$
    skip-if:
      - project: ^openstack/diskimage-builder$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$

  # Skip non-doc jobs for doc-only kolla changes.
  - name: ^gate-kolla.*(?<!docs-ubuntu-xenial)$
    skip-if:
      - project: ^openstack/kolla.*$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*
          - ^deploy-guide/source/.*

  - name: ^kolla-dsvm-build.*$
    branch: ^(?!stable/newton).*$

  - name: ^kolla-coverage-ubuntu-xenial-nv$
    branch: ^(?!stable/newton).*$
    skip-if:
      - project: ^openstack/kolla$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$

  # Do not run the documentation publishing jobs ({name}-docs) from
  # "bug/" branches. The (?!gate-) prefix is used in the regex because
  # we *do* want the gate docs jobs to run, just not the jobs in the
  # post queue.
  - name: ^(?!gate-).*-docs$
    branch: ^(?!bug/).*$

  - name: propose-openstack-manuals-updates
    branch: master

  # Packstack integration jobs should only run on master and stable/mitaka
  # onwards
  - name: ^gate-packstack-integration-.*-tempest-centos-7$
    skip-if:
      - project: openstack/packstack
        all-files-match-any:
          - ^releasenotes/.*$
          - ^docs/.*$

  # Puppet 3 is not supported in Pike and beyond, so we don't want to test it anymore.
  - name: ^gate-(tripleo-heat-templates|tripleo-.*|puppet-.*)-(syntax|unit)-3.*-legacy-centos-7$
    branch: ^(stable/(newton|ocata)).*$

  # no need to run the jobs for doc / releasenotes / unittests patches
  - name: ^gate-(puppet-.*-(syntax|unit|beaker)-|tripleo-ci-centos-7-).*$
    skip-if:
      - project: ^openstack/.*$
        all-files-match-any:
          - ^.*\.rst$
          - ^.*\.md$
          - ^doc/.*$
          - ^releasenotes/.*$
          - ^metadata.json$
          - ^etc/.*$
          - ^test-requirements.txt$

  # no need to run integration jobs when patching unit or beaker tests, reno or readme.
  - name: ^gate-(puppet-.*-tempest)-.*$
    skip-if:
      - project: ^openstack/puppet-.*$
        all-files-match-any:
          - ^.*\.md$
          - ^releasenotes/.*$
          - ^spec/.*$
          - ^metadata.json$
          - ^test-requirements.txt$
      - project: ^openstack/tempest$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$
          - ^etc/.*$
          - ^tempest/tests/.*$
          - ^tempest/hacking/.*$
          - ^test-requirements.txt$

  # Only run the puppet module build job on metadata.json updates
  - name: ^gate-puppet-.*module-build.*$
    files: ^metadata.json$

  # tripleo OVB jobs that do not run via tripleo-quickstart do not need to run
  # on patches that only touch the scripts/quickstart directory. This will save
  # a ton of resources while iterating on the tripleo-quickstart based CI.
  # This also makes sure to skip these jobs for doc / releasenotes / unittests
  # since it overwrites the rule above for these specific jobs
  # NOTE(trown) This will be removed once the oooq based jobs are stable. (pike-2 at the latest)
  # Note that this duplicates the lines above.
  - name: ^gate-tripleo-ci-centos-7-ovb-(?:\w*(?!-oooq))-*\w*$
    skip-if:
      - project: ^openstack-infra/tripleo-ci$
        all-files-match-any:
          - ^scripts/quickstart/.*$
          - ^toci_instack_oooq.sh$
          - ^toci_instack_oooq_multinode.sh$
      - project: ^openstack/puppet-.*$
        all-files-match-any:
          - ^.*\.md$
          - ^releasenotes/.*$
          - ^metadata.json$
      - project: ^openstack/tempest$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^etc/.*$
          - ^tempest/tests/.*$
          - ^tempest/hacking/.*$
          - ^releasenotes/.*$
      - project: ^openstack/(python-tripleoclient|tripleo-.*)$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$

  # no need to run the jobs for doc / releasenotes / unittests patches
  - name: ^gate-octavia-v1-dsvm(-py3x)?-scenario.*$
    skip-if:
      - project: ^openstack/octavia
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^etc/.*$
          - ^tempest/tests/.*$
          - ^tempest/hacking/.*$
          - ^releasenotes/.*$
          - ^api-ref/.*$

  # Only run the cross unittests on upper-constraints.txt updates
  - name: ^gate-cross-.*-python27.*$
    files: ^upper-constraints.txt$

  # Only run the cross 35 unittests on upper-constraints.txt updates
  - name: ^gate-cross-(?!networking-midonet).*-python35.*$
    files: ^upper-constraints.txt$
    branch: ^(?!stable/(newton|ocata)).*$

  # Run this only when upper-constraints.txt or upper-constraints-xfails.txt are changed.
  - name: ^gate-requirements-tox-py27-check-uc-ubuntu-xenial$
    files: ^upper-constraints.*txt$

  # Run this only when upper-constraints.txt or upper-constraints-xfails.txt are changed.
  # Also run this only for Queens+
  - name: ^gate-requirements-tox-py35-check-uc-ubuntu-xenial$
    branch: ^(?!stable/(newton|ocata|pike)).*$
    files: ^upper-constraints.*txt$

  # Only run the cross functional tests on upper-constraints.txt updates
  - name: ^gate-cross-.*-func-.*$
    files: ^upper-constraints.txt$

  - name: ^gate-cross-networking-midonet-python35
    voting: false

  # Aims to break when a new version of Puppet is released
  # For now, run the jobs only on master so if the job starts to
  # break due to Puppet new major release, we will see which branch
  # we need to test.
  - name: ^gate-puppet-.*-puppet-unit-latest-.*$
    branch: ^master
    voting: false

  # puppet-integration scenario004 was introduced after Newton (OpenStack)
  - name: ^gate-puppet-openstack-integration-4-scenario004.*$
    branch: ^(?!stable/newton).*$

  - name: gate-requirements-python34
    branch: master

  # For some projects, python35 is not passing on stable/newton
  # but passing on master, thus do not run it on newton.
  - name: ^gate-(requirements|murano-agent|networking-arista)-python35
    branch: ^(?!stable/newton).*$

  # This overrides the above "looser" match above, while we work through the
  # py34 -> py35 transition. Also note that this job will not work from
  # Ocata onwards as devstack drops support for trusty
  - name: gate-requirements-integration-dsvm-ubuntu-trusty
    branch: ^stable/newton$

  - name: ^gate-requirements-tox-validate-projects-ubuntu-xenial$
    branch: master

  - name: gate-requirements-tox-babel-ubuntu-xenial
    files:
      - '^babel-test/.*'
      - '^tox.ini'
      - '^upper-constraints.txt'

  # NOTE(mriedem): This job uses xenial nodes which restricts it to >= newton
  # changes. It also uses nova-network which is deprecated and not the default
  # in Ocata so we need to just restrict it to running on stable/newton
  # changes. nova-network in ocata will still have coverage in the cells v1
  # job.
  - name: ^gate-tempest-dsvm(-multinode)?-nnet-ubuntu-xenial
    branch: stable/newton

  # don't run any grenade jobs on the oldest supported stable
  # branch, this lets us catch all jobs that don't otherwise have
  # additional modifications.
  # NOTE(mriedem): This must be defined before any more specific grenade
  # job filters so that those can override the branch filter if necessary.
  - name: ^gate-grenade-dsvm
    branch: ^(?!(driverfixes|stable/(mitaka|newton))).*$

  # Grenade is tricky because we need it to start on old branch
  # then go up to new branch. This results in the following branch
  # to test node type mapping:
  # old -> new (new is the branch that determines what we want because
  # these are pullup jobs): distro release
  # mitaka -> newton: trusty
  # newton -> master/ocata: xenial
  # Note that we do not run these on the oldest supported branch,
  # currently newton.
  - name: ^.*grenade-.*-ubuntu-xenial$
    branch: ^(?!stable/newton).*$
  # For the forward grenade jobs we have the same mapping but the
  # branch on the left hand side is the one zuul is operating so is
  # the one that determines our selection of branch and distribution.
  # Thus, we do run on the oldest supported branch. No branch condition
  # is needed currently.
  # name: ^.*grenade-dsvm(-.*)?-forward-ubuntu-xenial$

  # Only here until stable is votable, then merge
  # back to a single job
  - name: ^.*grenade-dsvm(-.*)?-forward-ubuntu-xenial$
    voting: false

  - name: gate-rally-dsvm-verify-full-discover-resources
    files:
      - ^rally/cli/commands/verify.py$
      - ^rally/common/io/subunit_v2.py$
      - ^rally/ui/templates/verification.*$
      - ^rally/verification.*$
      - ^tests/ci/.*verify.*$

  - name: ^gate-rally-dsvm-verify-full-create-resources.*$
    files:
      - ^rally/cli/commands/verify.py$
      - ^rally/common/io/subunit_v2.py$
      - ^rally/ui/templates/verification.*$
      - ^rally/verification.*$
      - ^tests/ci/.*verify.*$

  # NOTE(rabi) (heat) run non-apache ocata and forward
  - name: ^gate-heat-dsvm-functional-convg-mysql-lbaasv2-non-apache-ubuntu-xenial$
    branch: ^(?!stable/newton).*$

  # NOTE(therve) (heat) run amqp1 job only on master
  - name: ^gate-heat-dsvm-functional-convg-mysql-lbaasv2-amqp1-ubuntu-xenial-nv$
    branch: master

  # NOTE(rabi) (heat) run py35 pike and forward
  - name: ^gate-heat-dsvm-functional-convg-mysql-lbaasv2-py35-ubuntu-xenial$
    branch: ^(?!stable/(newton|ocata)).*$

  # NOTE(ricolin) (heat-agents) run py35 pike and forward
  - name: ^gate-heat-agents-python35$
    branch: ^(?!stable/ocata).*$

  # NOTE(ricolin) (heat-agents) run docs pike and forward
  - name: ^gate-heat-agents-docs-ubuntu-xenial$
    branch: ^(?!stable/ocata).*$

  # NOTE(sambetts) Make networking-cisco tests against neutron master
  # non-voting so we aren't broken everytime neutron removes something
  - name: ^gate-networking-cisco-tox-master-ubuntu-xenial$
    voting: false

  # NOTE(sambetts) Make networking-cisco tests against neutron pike
  # non-voting until we complete compatiblity work
  - name: ^gate-networking-cisco-tox-pike-ubuntu-xenial$
    voting: false

  - name: ^gate-tempest-dsvm-networking-ovn-multinode-nv
    branch: ^(?!stable/newton).*$

  - name: ^gate-networking-ovn-dsvm-functional-py35
    branch: ^(?!stable/newton).*$

  - name: ^gate-tempest-dsvm-networking-bagpipe$
    branch: ^(?!stable/newton).*$

  - name: ^gate-networking-bagpipe-dsvm-fullstack-ubuntu-xenial
    branch: ^(?!stable/(newton|ocata)).*$

  # NOTE(tonyb):  networking-bgpvpn is only setup to manage requirements since
  # ocata, so don't run this job on older branches.
  - name: gate-networking-bgpvpn-requirements
    branch: ^(?!stable/newton).*$

  # NOTE(jlibosva) Run fullstack jobs only non-voting
  - name: ^gate-neutron-dsvm-fullstack-ubuntu-xenial
    voting: false

  - name: ^gate-neutron-dsvm-fullstack-python35-ubuntu-xenial.*$
    branch: ^(?!stable/(newton|ocata)).*$

  - name: ^gate-neutron-dsvm-functional-python35-ubuntu-xenial.*$
    branch: ^(?!stable/(newton|ocata)).*$

  - name: ^gate-tempest-dsvm-neutron-pg-full-ubuntu-xenial
    voting: false

  # scenario tests for neutron-dynamic-routing can be run on ocata and later
  - name: ^gate-neutron-dynamic-routing-dsvm-tempest-scenario.*$
    branch: ^(?!stable/newton).*$

  # Legacy api tests xenial - remove after newton EOL
  - name: ^gate-neutron-lbaasv2-dsvm-loadbalancer-ubuntu-xenial
    branch: ^stable/newton
  - name: ^gate-neutron-lbaasv2-dsvm-listener-ubuntu-xenial
    branch: ^stable/newton
  - name: ^gate-neutron-lbaasv2-dsvm-pool-ubuntu-xenial
    branch: ^stable/newton
  - name: ^gate-neutron-lbaasv2-dsvm-member-ubuntu-xenial
    branch: ^stable/newton
  - name: ^gate-neutron-lbaasv2-dsvm-healthmonitor-ubuntu-xenial
    branch: ^stable/newton
  - name: ^gate-neutron-lbaasv2-dsvm-minimal-ubuntu-xenial
    branch: ^stable/newton

  # This is a new test for Ocata forward
  - name: ^gate-neutron-lbaasv2-dsvm-api-ubuntu-xenial
    branch: ^(?!stable/newton).*$

  # This job is just to check Python 3.X compliance in master for NLBaaSv2
  - name: ^gate-neutron-lbaasv2-dsvm-py3x-.*$
    branch: ^(?!stable)

  # stable/newton octavia does not have multinode gate support
  - name: ^gate-octavia-v1-dsvm-.*-multinode$
    branch: ^(?!stable/newton).*$

  # This job is just to check Python 3.X compliance in master for Octavia
  - name: ^gate-octavia-v1-dsvm-py3x-.*$
    branch: ^(?!stable)

  # Octavia functional tests
  - name: ^gate-octavia-tox-functional-ubuntu-xenial
    branch: ^(?!stable/newton).*$

  # Octavia functional tests on python 3 - for now NV
  - name: ^gate-octavia-tox-functional-py35-ubuntu-xenial
    branch: ^(?!stable/(newton|ocata)).*$

  # Octavia tests based on LXD starting from Pike
  - name: ^gate-octavia-v1-dsvm-scenario-lxd
    branch: ^(?!stable/(newton|ocata)).*$

    # BUG #1290562 pypy does not work with new setuptools, so is breaking
    # all jobs. Disable until there is resolution.
  - name: ^gate-.*-pypy$
    voting: false

  - name: ^gate-tempest-dsvm-ironic-parallel-ubuntu-xenial-nv$
    branch: ^(?!stable)

  # Ironic stand-alone was enabled in the Pike cycle
  - name: ^gate-ironic-dsvm-standalone-.*$
    branch: ^(?!stable/(newton|ocata)).*$

  # Ironic grenade multi-node multi-tenant was enabled in the Pike cycle
  - name: ^gate-grenade-dsvm-ironic-multinode-multitenant-.*$
    branch: ^(?!stable/(newton|ocata)).*$

  - name: ^gate-ironic-python-agent-tox-func-ubuntu-xenial$
    voting: false

  - name: ^gate-devstack-dsvm-updown.*$
    branch: ^(?!stable)

  # This job is just to check py3 compliance in master
  - name: ^gate-devstack-dsvm-py3(5|6)-updown.*$
    branch: ^(?!stable)

  # This job is just to check py35 compliance in master
  - name: ^gate-tempest-dsvm-py35.*$
    branch: ^(?!(stable|driverfixes))

  # NOTE(mriedem): This job requires nova-network which is not used in Ocata+
  # except in cells v1 configurations, so restrict it to Newton for Xenial.
  - name: gate-novaclient-dsvm-functional-ubuntu-xenial
    branch: ^stable/newton$

  # Do not run magnum migration tests on doc changes and
  # keep magnum migration tests non-voting for now. Remove
  # this rule once we see some successful Jenkins runs.
  - name: ^gate-magnum-tox-migration-ubuntu-xenial$
    voting: false
    skip-if:
      - project: ^openstack/magnum$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$

  - name: ^gate-functional-dsvm-magnum-api.*
    skip-if:
      - project: ^openstack/magnum$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$

  - name: ^gate-functional-dsvm-magnum-k8s.*
    skip-if:
      - project: ^openstack/magnum$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^magnum/drivers/swarm.*$
          - ^magnum/drivers/mesos.*$

  - name: ^gate-functional-dsvm-magnum-swarm.*
    skip-if:
      - project: ^openstack/magnum$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^magnum/drivers/k8s.*$
          - ^magnum/drivers/mesos.*$

  # Swarm mode was introduced in the Pike cycle, therefore
  # skip the job for the older releases.
  - name: ^gate-functional-dsvm-magnum-swarm-mode.*
    branch: ^(?!stable/(newton|ocata)).*$

  - name: ^gate-functional-dsvm-magnum-mesos.*
    skip-if:
      - project: ^openstack/magnum$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^magnum/drivers/k8s.*$
          - ^magnum/drivers/swarm.*$

  - name: ^gate-zun-devstack-dsvm.*
    skip-if:
      - project: ^openstack/zun$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$

  - name: gate-tempest-dsvm-multinode-live-migration-ubuntu-xenial
    skip-if:
      - project: ^openstack/nova$
        all-files-match-any:
          - ^.git.*$
          - ^.*\.rst$
          - ^doc/.*$
          - ^api-.*$
          - ^nova/tests/unit/.*$
          - ^nova/tests/functional/.*$
          - ^nova/tests/.*\.py$
          - ^nova/hacking/.*$
          - ^nova/locale/.*$
          - ^releasenotes/.*$
          - ^tests-py3.txt$
          - ^tools/.*$
          - ^tox.ini$

  # NOTE(mriedem): The nova-next job runs with the placement-api service and
  # cells v2, both of which were optional in newton but required started in
  # ocata. We pin this job to stable/ocata so that upgrade tests on ocata
  # changes will test deploying placement/cellsv2 on newton nodes and uprading
  # to ocata. This job isn't interesting after ocata because the normal
  # grenade job tests the same thing by default.
  - name: gate-grenade-dsvm-neutron-nova-next-ubuntu-xenial-nv
    branch: ^stable/ocata$

  - name: gate-grenade-dsvm-neutron-multinode-live-migration-nv
    branch: ^(?!stable/newton).*$
    skip-if:
      - project: ^openstack/nova$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^api-.*$
          - ^nova/tests/unit/.*$
          - ^nova/tests/functional/.*$
          - ^nova/tests/.*\.py$
          - ^nova/hacking/.*$
          - ^nova/locale/.*$
          - ^releasenotes/.*$
          - ^tests-py3.txt$
          - ^tools/.*$
          - ^tox.ini$

  # Only run the neutron LB job on nova if there are changes to nova/network/*
  # or nova/virt/libvirt/vif.py since that uses os-vif for LB vif type.
  # TODO(mriedem): Run this proper on all changes once nova-network is dropped.
  - name: ^gate-tempest-dsvm-neutron-linuxbridge-ubuntu-xenial$
    skip-if:
      - project: ^openstack/nova$
        all-files-match-any:
          - ^(?!nova/network/.*)(?!nova/virt/libvirt/vif.py).*$
      - project: ^openstack/neutron$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^neutron/locale/.*$
          - ^neutron/tests/.*$
          - ^releasenotes/.*$
          - ^tools/.*$
          - ^tox.ini$

  # gate-tempest-dsvm-networking-midonet variants
  #
  #    v2                    <=Ocata
  #    v2-full   >=Ocata and <=Ocata  (That is, Ocata only)
  #    ml2       all branches
  #    ml2-full  >=Ocata
  #
  # NOTE(yamamoto): v2 is going to be removed in Pike.
  # NOTE(yamamoto): -full variants have been introduced in Ocata.
  # NOTE(yamamoto): The last matching entry wins.

  - name: ^gate-tempest-dsvm-networking-midonet-aio-v2
    branch: ^stable/(newton|ocata)

  - name: ^gate-tempest-dsvm-networking-midonet-aio-v2-full
    branch: ^stable/ocata

  - name: ^gate-tempest-dsvm-networking-midonet-aio-ml2-full
    branch: ^(?!stable/newton).*$

  - name: ^gate-tempest-dsvm-networking-midonet-aio-ml2.*-centos-7
    branch: ^(?!stable/newton).*$

  - name: ^gate-tempest-dsvm-networking-midonet-aio-ml2-full-legacy-ubuntu-xenial
    branch: ^(?!stable/(newton|ocata|pike)).*$

  - name: ^gate-grenade-dsvm-networking-midonet-ml2-ubuntu-xenial
    branch: ^(?!stable/newton).*$

  - name: ^gate-grenade-dsvm-networking-midonet-v2-ubuntu-xenial
    branch: ^stable/pike$

  # gate-networking-midonet-rally-dsvm variants
  #
  #    v2        >=Ocata and <=Ocata  (That is, Ocata only)
  #    ml2       >=Ocata
  #
  # NOTE(yamamoto): v2 is going to be removed in Pike.

  - name: ^gate-networking-midonet-rally-dsvm-v2-ubuntu-xenial
    branch: ^stable/ocata

  - name: ^gate-networking-midonet-rally-dsvm-ml2-ubuntu-xenial
    branch: ^(?!stable/newton).*$

  - name: ^gate-tempest-dsvm-networking-odl-.+-snapshot-v2driver
    branch: ^(?!stable/newton).*$

  - name: ^gate-tempest-dsvm-networking-odl-nitrogen-snapshot-vpnservice-.+
    branch: ^(?!stable/(newton|ocata)).*$

  - name: ^gate-dsvm-networking-odl-.+$
    branch: ^(?!stable/newton).*$

  - name: ^gate-rally-dsvm-networking-odl-nitrogen-snapshot
    branch: ^(?!stable/(newton|ocata|pike)).*$

  - name: ^gate-rally-dsvm-networking-odl-.+-snapshot
    branch: ^(?!stable/newton).*$

  - name: ^gate-dsvm-networking-odl-fullstack-carbon-snapshot
    branch: ^(?!stable/(newton|ocata)).*$

  - name: ^gate-dsvm-networking-odl-(fullstack|functional)-nitrogen-snapshot
    branch: ^(?!stable/(newton|ocata|pike)).*$

  - name: ^gate-neutron-fwaas-v1-dsvm-tempest-multinode-nv$
    branch: ^(?!stable/newton).*$

  - name: ^gate-neutron-fwaas-v2-dsvm-tempest-multinode-nv$
    branch: ^(?!stable/newton).*$

  - name: ^gate-neutron-fwaas-dsvm-fullstack-ubuntu-xenial-nv$
    branch: ^(?!stable/newton).*$

# For Gerrit ver 2.8.x and later (using buck)
  - name: ^.*gerrit.*buck$
    branch: ^openstack/(?!2\.4).*$

  - name: ^gate-python-cinderclient-pylint.*$
    voting: false

  - name: ^gate-os-brick-pylint.*$
    voting: false

  # Special handling for cinder driverfixes branches:
  # Only pep8 and unit tests should run on it, nothing else.

  - name: ^gate-cinder-(api-ref|requirements)$
    branch: ^(?!driverfixes/).*$

  - name: ^gate-tempest-dsvm-full-devstack-plugin-nfs
    branch: ^(?!driverfixes/).*

  # Xenial jobs
  - name: ^gate-cinder-(docs|pylint)-ubuntu-xenial$
    branch: ^(?!driverfixes/).*$

  - name: ^gate-cinder-python27-ubuntu-xenial$
    branch: ^(?!driverfixes/mitaka).*$

  - name: ^gate-cinder-python35
    branch: ^(?!driverfixes/).*$

  - name: ^gate-tempest-dsvm-lvm-multibackend-ubuntu-xenial-nv$
    branch: ^(?!driverfixes/).*$

  # This job should run on driverfixes/mitaka branch
  - name: ^gate-cinder-pep8-ubuntu-trusty
    branch: ^(driverfixes/mitaka).*$

  # This job should run on future driverfixes/ branches
  - name: ^gate-cinder-pep8-ubuntu-xenial
    branch: ^(?!driverfixes/mitaka).*$

  # Skip post job for driverfixes
  - name: ^cinder-.*$
    branch: ^(?!driverfixes/).*$

  - name: ^gate-cinder-pylint.*$
    voting: false

  - name: ^gate-cinder-tox-functional-ubuntu-xenial$
    branch: ^(?!driverfixes/).*$
    voting: false

  - name: ^gate-cinder-tox-compliance-ubuntu-xenial$
    branch: ^(?!driverfixes/).*$

  - name: ^gate-cinder-tox-bandit-baseline-ubuntu-xenial$
    branch: ^(?!(stable/(newton|ocata)|driverfixes/)).*$
    voting: false

  # All python 3.x jobs should test master only
  - name: ^gate-rally-dsvm-py35.*$
    branch: master

  - name: ^gate-rally-dsvm-cinder-ubuntu-xenial.*$
    branch: ^(?!driverfixes/).*$

    # NOTE(tbarron): Ensure this job is stable in master (Pike) before
    # making it vote.   Python 3.x job tests only from Pike forwards.
  - name: ^gate-tempest-dsvm-py35-full-devstack-plugin-ceph-ubuntu-xenial.*$
    branch: ^(?!(stable/(newton|ocata)|driverfixes/)).*$

    # NOTE(jordanP): Non-voting is temporary until the job stabilizes in
    # master (Pike).
  - name: ^gate-tempest-dsvm-full-devstack-plugin-ceph-ubuntu-xenial.*$
    branch: ^(?!driverfixes/).*$
    voting: false

    # NOTE(mriedem): Non-voting is temporary until the job stabilizes in
    # master (Pike).
  - name: ^gate-tempest-dsvm-full-ceph-plugin-src-.*-ubuntu-xenial.*$
    branch: ^(?!driverfixes/).*$
    voting: false

  - name: ^gate-tempest-dsvm-full-drbd-devstack-ubuntu-xenial.*$
    branch: ^(?!driverfixes/).*$

  - name: ^gate-tempest-dsvm-full-lio-ubuntu-xenial.*$
    branch: ^(?!driverfixes/).*$

  - name: ^gate-tempest-dsvm-full-sheepdog-ubuntu-xenial.*$
    branch: ^(?!driverfixes/).*$

  - name: gate-tempest-dsvm-neutron-full-ubuntu-xenial
    # This job is part of integrated gate queue, use it to name the queue.
    # Note that the above needs to be a name and not a regex so that
    # queue-name works.
    queue-name: integrated
    branch: ^(?!driverfixes/).*$

  - name: ^gate-jenkins-job-builder-tox-docs-linkcheck-ubuntu-xenial$
    voting: false
    failure-message: WARNING broken links in docs

  - name: gate-git-upstream-tox-docs-linkcheck-ubuntu-xenial
    voting: false
    failure-message: WARNING broken links in docs

  - name: gate-bashate-devstack
    voting: false

  - name: ^gate-bindep-bindep-fallback.*$
    # Add explicit branch so that this overrides earlier
    # restrictions.
    branch: master

  - name: ^gate-i18n-tox-doc-publish-docs.*$
    success-pattern: http://docs-draft.openstack.org/{build.parameters[LOG_PATH]}/publish-docs/i18n/latest

  - name: ^gate-.*-tox-doc-publish-checkbuild.*$
    success-pattern: http://docs-draft.openstack.org/{build.parameters[LOG_PATH]}/publish-docs/

  - name: ^gate-.*-tox-doc-publish-checklang$
    success-pattern: http://docs-draft.openstack.org/{build.parameters[LOG_PATH]}/publish-docs/
    # Only run job if at least one po or pot file was changed
    files:
      - '^.*\.po$'
      - '^.*\.pot$'

  - name: ^gate-.*-docs-ubuntu-(trusty|xenial)$
    success-pattern: http://docs-draft.openstack.org/{build.parameters[LOG_PATH]}/doc/build/html/

  - name: ^gate-.*-api-guide$
    success-pattern: http://docs-draft.openstack.org/{build.parameters[LOG_PATH]}/api-guide/build/html/
    branch: master
    files:
      - '^tox.ini$'
      - '^api-guide/.*'

  - name: ^gate-.*-api-ref$
    success-pattern: http://docs-draft.openstack.org/{build.parameters[LOG_PATH]}/api-ref/build/html/
    branch: master
    files:
      - '^tox.ini$'
      - '^api-ref/.*'
      - '^doc/api_samples/.*'

  - name: ^gate-placement-api-ref$
    success-pattern: http://docs-draft.openstack.org/{build.parameters[LOG_PATH]}/placement-api-ref/build/html/
    branch: master
    files:
      - '^tox.ini$'
      - '^placement-api-ref/.*'

  - name: ^gate-.*-api-ref-src$
    success-pattern: http://docs-draft.openstack.org/{build.parameters[LOG_PATH]}/api-ref/build/html/

  # For openstackdocstheme, we want to publish with each change, so extend
  # the files section.
  - name: ^gate-openstackdocstheme-api-ref$
    files:
      - '^tox.ini$'
      - '^api-ref/.*'
      - '^doc/.*$'
      - '^openstackdocstheme/.*$'
      - '^.*\.txt$'
      - '^.*\.rst$'

  - name: ^gate-.*-install-guide$
    success-pattern: http://docs-draft.openstack.org/{build.parameters[LOG_PATH]}/install-guide/build/html/
    # Starting with Pike, the install guide is not a separate build
    # anymore, it is integrated into the docs tree.
    # The job was introduced in newton, so handle newton and ocata only.
    branch: ^stable/(newton|ocata).*$
    files:
      - '^tox.ini$'
      - '^install-guide/.*'
      - 'bindep.txt'
      - other-requirements.txt

    # Starting with Pike, the install guide is not a separate build
    # anymore, it is integrated into the docs tree.
    # The job was introduced in newton, so handle newton and ocata only.
  - name: ^(?!gate-).*-install-guide$
    branch: ^stable/(newton|ocata).*$

  - name: ^gate-.*-deploy-guide$
    success-pattern: http://docs-draft.openstack.org/{build.parameters[LOG_PATH]}/deploy-guide/build/html/
    files:
      - '^tox.ini$'
      - '^deploy-guide/.*'
      - 'bindep.txt'
      - other-requirements.txt

  - name: ^(?!gate-).*-api-guide$
    # Only publish from master
    branch: master

  - name: ^(?!gate-).*-api-ref$
    # Only publish from master
    branch: master

  - name: gate-murano-firstapp-docs
    # Only publish from master
    branch: master
    success-pattern: http://docs-draft.openstack.org/{build.parameters[LOG_PATH]}/doc/build/murano-firstapp/html/
    files:
      - '^tox.ini$'
      - '^doc/source/first-app/.*'
      - bindep.txt
      - '^.*requirements.txt$'

  - name: ^gate-.*-js-draft
    success-pattern: http://docs-draft.openstack.org/{build.parameters[LOG_PATH]}/dist/

  - name: ^gate-.*-npm-docs$
    success-pattern: http://docs-draft.openstack.org/{build.parameters[LOG_PATH]}/doc/build/html/

  - name: infra-publications-publish
    branch: ^(?!master).*$

  - name: ^gate-.*-requirements$
    failure-message: FAILURE Incompatible requirement found
    files:
      - '^tools/.*-requires$'
      - '^.*requirements.txt$'
      - '^.*requirements-py[2,3].txt$'

  - name: gate-app-catalog-ui-nodejs4-npm-run-lint
    voting: false

  - name: ^magnum-coverage-ubuntu-xenial.*$
    skip-if:
      - project: ^openstack/magnum$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$

  - name: ^gate-barbican-simple-crypto-dsvm-tempest-.*$
    branch: ^(?!stable/(newton|ocata)).*$

    # The .*-dsvm-functional jobs only work on Pike and beyond
  - name: ^gate-barbican-.*-dsvm-functional-.*$
    branch: ^(?!stable/(newton|ocata)).*$

    # Run the ./*-devstack- jobs only on newton and ocata branches
    # (the .*-dsvm-functional jobs replace them in Pike)
  - name: ^gate-barbican-.*-devstack-.*$
    branch: ^(?:stable/(newton|ocata)).*$

    # The .*-dsvm jobs only work on Pike and beyond
  - name: ^gate-python-barbicanclient-dsvm-.*$
    branch: ^(?!stable/(newton|ocata)).*$

    # Run the ./*-devstack- jobs only on newton and ocata branches
    # (the .*-dsvm jobs replace them in Pike)
  - name: ^gate-python-barbicanclient-devstack-.*$
    branch: ^(?:stable/(newton|ocata)).*$

  - name: ^gate-grenade-dsvm-barbican-ubuntu-xenial$
    branch: ^(?!stable/(newton|ocata)).*$

  - name: ^gate-tempest-dsvm-designate-pdns4-postgres-ubuntu-xenial(-nv)?$
    branch: ^(?!stable/newton).*$

  - name: ^gate-tempest-dsvm-designate-pdns4-py35-ubuntu-xenial-nv$
    branch: ^(?!stable/(newton|ocata)).*$

  - name: gate-hacking-integration-nova
    voting: false

  - name: gate-elastic-recheck-tox-queries-ubuntu-xenial
    voting: false

  - name: ^gate-sahara-pylint.*$
    voting: false

  - name: ^gate-sahara-dsvm-scenario-multinode-spark-ubuntu-xenial-nv$
    branch: ^(?!stable/(newton|ocata)).*$

  - name: ^gate-sahara-dsvm-scenario-py3-ubuntu-xenial-nv$
    branch: ^(?!stable/(newton|ocata)).*$

  - name: ^gate-sahara-dsvm-scenario-mod-wsgi-ubuntu-xenial-nv$
    branch: ^(?!stable/(newton|ocata)).*$

  - name: ^gate-sahara-dashboard-dsvm-integration.*$
    voting: false

  # Until Ocata, only Django 1.8.x is supported
  - name: ^gate-sahara-dashboard-tox-py27dj110-ubuntu-xenial$
    branch: ^(?!stable/(newton|ocata)).*$
    voting: false

  - name: ^gate-sahara-tests-pylint.*
    voting: false

  # run tempest tests for sahara-tests only when the directory
  # which contains the tempest tests is changed.
  - name: ^gate-tempest-dsvm-sahara.*$
    skip-if:
      - project: ^openstack/sahara-tests$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$
          - ^etc/.*$
          - ^sahara_tests/.*$
          - ^sahara_tempest_plugin/tests/cli/.*$
          - ^sahara_cli_tests/.*$
          - ^tools/.*$
          - ^tox.ini$

  # do not run sahara scenario tests when the change is only
  # about documentation and/or the Tempest plugin.
  - name: ^gate-sahara-dsvm-scenario.*$
    skip-if:
      - project: ^openstack/sahara$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$
      - project: ^openstack/sahara-tests$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$
          - ^sahara_tempest_plugin/.*$

  - name: gate-app-catalog-ui-dsvm-integration
    voting: false

  - name: ^gate-keystone-tox-patch_cover-ubuntu-xenial$
    voting: false

  # This job is just to check py35 compliance in master
  - name: ^gate-keystone-dsvm-py35-.*$
    branch: ^(?!stable)

  - name: check-osc-plugins
    voting: false

  - name: gate-python-troveclient-pypy
    voting: false

  - name: gate-mistral-devstack-dsvm-kombu-ubuntu-xenial-nv
    branch: ^(?!stable/newton).*$

  - name: ^gate-mistral-tox-unit-mysql-ubuntu-xenial$
    voting: false

  - name: ^gate-mistral-tox-unit-postgresql-ubuntu-xenial$
    voting: false

  # NOTE(bcrochet) (mistral) run non-apache pike and forward
  - name: ^gate-mistral-devstack-dsvm-non-apache-ubuntu-xenial-nv
    branch: ^(?!stable/(newton|ocata)).*$

  - name: gate-mistral-docker-buildimage
    branch: master

  # NOTE(kzaitsev): nodejs4-npm-run-test was added in ocata
  - name: ^gate-murano-dashboard-nodejs4-npm-run-test$
    branch: ^(?!stable/newton).*$

  # NOTE(limao): Only run these jobs on kuryr-libnetwork master branch,
  # because we do not need to check if kuryr-libnetwork  stable branch
  # can work with kuryr_lib master.
  - name: gate-kuryr-libnetwork-kuryr_lib-src-dsvm-fullstack-ubuntu-xenial
    branch: master

  # NOTE(limao): Only run these jobs on kuryr-libnetwork master branch,
  # because we do not need to check if kuryr-libnetwork  stable branch
  # can work with kuryr_lib master.
  - name: gate-kuryr-libnetwork-kuryr_lib-src-dsvm-rally-ubuntu-xenial-nv
    branch: master

  - name: gate-solum-infra-guestagent-pypy
    voting: false

  - name: gate-solum-pypy
    voting: false

  - name: gate-solum-requirements
    voting: false

  - name: ^gate-sqlalchemy-migrate-pep8-ubuntu-xenial
    voting: false

  - name: ^gate-manila-pylint.*$
    voting: false

  - name: gate-manila-buildimage-docker-ubuntu-xenial
    voting: false

  - name: ^gate-manila-(tempest|docs|ui).*
    branch: ^(?!driverfixes/).*$

  - name: gate-grenade-dsvm-manila-ubuntu-xenial-nv
    branch: ^(?!driverfixes/).*$

  - name: ^gate-manila-tempest-dsvm-.*-scenario-custom-image-.*
    branch: ^(?!stable/newton).*$

  - name: ^gate-manila-tempest-minimal-dsvm-cephfs-nfs.*$
    branch: ^(?!(driverfixes|stable/(?:newton|ocata))).*$

  - name: gate-manila-tempest-minimal-dsvm-lvm-centos-7
    branch: ^(?!(driverfixes|stable/newton)).*$

  # amqp1 hybrid and dual support added in pike:
  - name: ^gate-tempest-neutron-dsvm-src-oslo.messaging-amqp1-(hybrid|dual)-.*$
    branch: ^(?!stable/(?:newton|ocata)).*$

  - name: ^gate-oslo.messaging-src-dsvm-full-amqp1-(hybrid|dual)-.*$
    branch: ^(?!stable/(?:newton|ocata)).*$

  # tox based functional tests run in >= ocata
  - name: ^gate-oslo.messaging-tox-.*-func-.*$
    branch: ^(?!stable/newton).*$

  - name: ^gate-oslo.messaging-tox-py27-func-(kafka|zmq-proxy|zmq-pubsub)-.*$
    voting: false

  - name: ^gate-oslo.messaging-tox-py35-func-(rabbit|zmq)-.*$
    voting: false

  # Timeout often see: BUG #1668187
  - name: ^gate-oslo.messaging-tox-py27-func-zmq-ubuntu-xenial$
    voting: false

  # openSUSE support for devstack has been added in Pike
  - name: ^gate-tempest-dsvm-neutron-full-opensuse-.*$
    branch: ^(?!stable/(newton|ocata)).*$

  # Rally jobs for Manila only for non driverfixes, ocata+ branches
  - name: gate-rally-dsvm-manila-multibackend
    branch: ^(?!stable/newton|driverfixes/).*$
    voting: false

  - name: gate-rally-dsvm-manila-multibackend-no-ss
    branch: ^(?!stable/newton|driverfixes/).*$
    voting: false

  - name: gate-manila-ui-dsvm-nv
    branch: ^(?!driverfixes|stable/newton).*$

  - name: ^gate-blazar-pylint.*$
    voting: false

  - name: gate-tempest-dsvm-neutron-ipv6only-nv
    branch: master

  - name: gate-tempest-dsvm-neutron-serviceipv6-nv
    branch: master

  - name: ^gate-trove-legacy-scenario-dsvm-.*$
    branch: ^stable/newton$

  - name: ^gate-trove-scenario-dsvm-.*$
    branch: ^(?!stable/newton).*$

  # NOTE(amrith): This job should be run for trove-integration, and
  #               trove's and trove clients stable branches for
  #               newton.
  - name: ^gate-trove-legacy-functional-dsvm-.*$
    skip-if:
      - project: ^openstack/(trove|python-troveclient)$
        branch: ^(?!stable/newton).*$

  - name: ^gate-trove-functional-dsvm-.*$
    branch: ^(?!stable/newton).*$

  - name: ^gate-tempest-dsvm-full-lio-ubuntu-xenial
    voting: false

  - name: ^gate-aodh-dsvm-functional-(hbase|mongodb)-ubuntu-xenial
    branch: stable/newton

  - name: ^gate-aodh-dsvm-functional-(mysql|postgresql)-ubuntu-xenial
    branch: ^stable/(newton|ocata)$

  - name: ^gate-aodh-dsvm-tempest-plugin-(hbase|mongodb)-ubuntu-xenial
    branch: stable/newton

  # TODO(lcastell): Make voting once tests are fixed
  - name: ^gate-craton-dashboard-nodejs4-npm-run-test$
    voting: false

  - name: gate-horizon-tox-py27dj18-ubuntu-xenial
    branch: ^(?!stable/(newton|ocata)).*$

  - name: gate-django_openstack_auth-tox-py27dj18-ubuntu-xenial
    branch: ^(?!stable/(newton|ocata)).*$

  # TODO(liuqing): Make voting once tests are proven to pass reliably
  - name: gate-senlin-dashboard-nodejs4-npm-run-lint
    voting: false

  # TODO(liuqing): Make voting once tests are proven to pass reliably
  - name: gate-senlin-dashboard-nodejs4-npm-run-test
    voting: false

  # TODO(shu-mutou): Make voting once tests are proven to pass reliably
  - name: gate-zaqar-ui-nodejs4-npm-run-lint
    voting: false

  # TODO(shu-mutou): Make voting once tests are proven to pass reliably
  - name: gate-zaqar-ui-nodejs4-npm-run-test
    voting: false

  # TODO(shu-mutou): Make voting once tests are proven to pass reliably
  - name: gate-zun-ui-nodejs4-npm-run-test
    voting: false

  # TODO(anusree): Make voting once tests are proven to pass reliably
  - name: gate-designate-dashboard-nodejs4-npm-run-lint
    voting: false

  # TODO(anusree): Make voting once tests are proven to pass reliably
  - name: gate-designate-dashboard-nodejs4-npm-run-test
    voting: false

  - name: ^gate-horizon-selenium-headless-legacy-ubuntu-xenial
    branch: ^(stable/newton).*$

  - name: gate-horizon-selenium-headless-ubuntu-xenial
    branch: ^(?!stable/newton).*$

  - name: ^(gate-)?devstack-docs
    branch: ^master

  - name: ^gate-tempest-dsvm-neutron.*-ovs.*$
    tags: neutron

  - name: ^gate-fuel-agent-python.*$
    branch: ^(?!stable/(?:5\.0|5\.1|6\.0|6\.1|7\.0)).*$

  - name: ^gate-fuel-dev-tools-python.*$
    branch: ^(?!stable/(?:5\.0|5\.1|6\.0|6\.1|7\.0)).*$

  - name: ^gate-fuel-devops-python3.*$
    branch: ^(?!(release/(?:2\.9)|stable)).*$

  - name: ^fuel-devops-coverage-ubuntu-xenial$
    branch: ^(?!(release/(?:2\.9)|stable)).*$

  - name: ^gate-fuel-devops-pylint
    branch: ^(?!(release/(?:2\.9)|stable)).*$
    voting: false

  - name: ^gate-fuel-devops-docs
    branch: ^(?!release/(?:2\.9)).*$

  - name: ^gate-fuel-qa-pylint
    branch: ^(?!stable(-mu)?/(?:4\.0|4\.1|5\.0|5\.1|6\.0|6\.1|7\.0|8\.0)).*$

  - name: ^gate-fuel-qa-python27-ubuntu-trusty
    branch: ^stable(-mu)?/(8\.0|7\.0|6\.1).*$

  - name: ^gate-fuel-qa-pep8-ubuntu-trusty
    branch: ^stable(-mu)?/(8\.0|7\.0|6\.1).*$

  - name: ^gate-fuel-qa-pep8-ubuntu-xenial$
    branch: ^(?!stable(-mu)?/(?:4\.0|4\.1|5\.0|5\.1|6\.0|6\.1|7\.0|8\.0)).*$

  - name: ^gate-fuel-qa-python27-ubuntu-xenial$
    branch: ^(?!stable(-mu)?/(?:4\.0|4\.1|5\.0|5\.1|6\.0|6\.1|7\.0|8\.0)).*$

  - name: ^gate-fuel-library-puppet-syntax.*$
    branch: ^(?!stable/(?:4\.0|4\.1|5\.0|5\.1|6\.0|6\.1|7\.0)).*$

  - name: ^gate-fuel-library-puppet-unit.*$
    branch: ^(?!stable/(?:4\.0|4\.1|5\.0|5\.1|6\.0|6\.1|7\.0)).*$

  - name: ^gate-fuel-library-puppet-syntax-4-centos-7
    branch: ^(?!stable/(?:4\.0|4\.1|5\.0|5\.1|6\.0|6\.1|7\.0|8\.0)).*$

  - name: ^gate-fuel-library-puppet-unit-4\.5-centos-7
    branch: ^(?!stable/(?:4\.0|4\.1|5\.0|5\.1|6\.0|6\.1|7\.0|8\.0)).*$

  - name: ^gate-fuel-mirror-python.*$
    branch: ^stable/8\.0.*$

  - name: ^gate-fuel-ostf-python27-ubuntu-xenial
    branch: ^(?!stable/(?:5\.0|5\.1|6\.0|6\.1|7\.0)).*$

  - name: ^gate-fuel-plugins-python.*$
    branch: ^(?!stable/(?:5\.0|5\.1|6\.0|6\.1|7\.0)).*$

  - name: ^gate-fuel-stats-python.*$
    branch: ^(?!stable/(?:5\.0|5\.1|6\.0|6\.1|7\.0)).*$

  - name: ^gate-fuel-web-docs-ubuntu-xenial
    branch: ^(?!stable/(?:5\.0|5\.1|6\.0|6\.1|7\.0|8\.0)).*$
    voting: false

  - name: ^gate-fuel-web-python27-ubuntu-trusty
    branch: ^stable/8\.0.*$

  - name: ^gate-fuel-web-python27-ubuntu-xenial
    branch: ^(?!stable/(?:5\.0|5\.1|6\.0|6\.1|7\.0|8\.0)).*$

  - name: ^gate-ceilometer-dsvm-functional-.*ubuntu-xenial
    branch: ^stable/newton$

  - name: ^gate-ceilometer-tox-.*
    branch: ^(?!stable/newton)

  # toxenv func-post-as-copy doesn't exist in swift before ocata.
  - name: ^gate-swift-tox-xfs-tmp-func-post-as-copy-(ubuntu-xenial|centos-7)$
    branch: ^(?!stable/newton).*$

  # pre-ocata, func covered post-as-copy behavior,
  # and func-fast-post covered the now-default fast-post behavior
  - name: ^gate-swift-tox-xfs-tmp-func-fast-post-(ubuntu-xenial|centos-7)$
    branch: ^stable/newton$

  # toxenv func-ec only works on current master and only future stable branches.
  - name: ^gate-swift-tox-xfs-tmp-func-ec-(ubuntu-xenial|centos-7)$
    branch: ^(?!stable/(newton|ocata)).*$
    voting: false

  - name: ^gate-murano-apps-linters-ubuntu-xenial$
    voting: false

  - name: ^gate-dsvm-murano-apps-refstackclient-unittest-ubuntu-xenial-nv
    files:
      - 'RefStackClient/.*'

  - name: periodic-tempest-dsvm-full-test-accounts-ubuntu-xenial-master
    tags: periodic-qa
  - name: periodic-tempest-dsvm-neutron-full-test-accounts-ubuntu-xenial-master
    tags: periodic-qa
  - name: periodic-tempest-dsvm-neutron-full-non-admin-ubuntu-xenial-master
    tags: periodic-qa
  - name: periodic-tempest-dsvm-all-master
    tags: periodic-qa

  # Skip all openstack-ansible and ansible-hardening jobs except the
  # releasenotes/docs/linters/deploy-guide jobs for files that are not related
  # to functional testing.
  - name: ^gate-(openstack-ansible|ansible-hardening)(?!.*(-docs|-releasenotes|-deploy-guide|-linters-ubuntu-xenial)).*$
    skip-if:
      - project: ^openstack/(openstack-ansible|ansible-hardening)(?!-specs).*$
        all-files-match-any:
          - ^\.git.*
          - ^.*\.(example|md|rst)$
          - ^deploy-guide/.*
          - ^doc/.*
          - ^releasenotes/.*
          - ^setup\.(cfg|py)$
          - ^tox.ini$
          - ^Vagrantfile

  # Run all OpenStack-Ansible trusty jobs except the docs and linters jobs
  # for Newton as this is still a supported platform for OpenStack-Ansible.
  # Trusty support is removed after Newton, so don't run any ubuntu-trusty
  # jobs against branches > stable/newton.
  # Since regexes override each other (last one wins), we can stage this.
  # First, we run all trusty jobs on newton:
  - name: ^gate-openstack-ansible.*-ubuntu-trusty.*$
    branch: ^stable/newton$

  # Keep in mind that stable/newton is ubuntu only,
  # so we remove centos-7 jobs.
  - name: ^gate-openstack-ansible-.*-ansible-.*-centos-7.*$
    branch: ^(?!stable/newton).*$

  # openSUSE support has been added in the Pike release.
  - name: ^gate-openstack-ansible-.*-ansible-.*-opensuse-423.*$
    branch: ^(?!stable/(newton|ocata)).*$

  # Now some specific conditions for openstack-ansible:

  # Run the os_keystone extra functional test jobs on trusty for Newton only
  - name: ^gate-openstack-ansible-os_keystone-ansible-(uw_nginx|uw_apache)-ubuntu-trusty$
    branch: ^stable/newton$

  # Run the os_neutron extra functional test jobs on trusty for Newton only
  - name: ^gate-openstack-ansible-os_neutron-ansible-func_ovs-ubuntu-trusty$
    branch: ^stable/newton$

  # Run the OpenStack-Ansible non-voting aio scenario job on xenial for the
  # openstack-ansible repository if the branch is stable/newton.
  - name: ^gate-openstack-ansible-openstack-ansible-aio-ubuntu-xenial-nv$
    branch: ^stable/newton$

  # Restrictions for ansible-hardening
  #   - Run centos-7 job on Newton or later (no restriction needed)
  #   - Run debian-jessie job on Pike or later
  #   - Run fedora-26 job on Pike or later
  #   - Run opensuse-423 job on Pike or later
  #   - Run RHEL 6 STIG content job on Pike or earlier
  - name: ^gate-ansible-hardening-ansible-func-debian-jessie.*$
    branch: ^(?!stable/(newton|ocata)).*$
  - name: ^gate-ansible-hardening-ansible-func-fedora-26.*$
    branch: ^(?!stable/(newton|ocata)).*$
  - name: ^gate-ansible-hardening-ansible-func-opensuse-423.*$
    branch: ^(?!stable/(newton|ocata)).*$
  - name: ^gate-ansible-hardening-.*-ubuntu-trusty.*$
    branch: ^stable/(newton|ocata|pike)$

  # Skip the OpenStack-Ansible voting aio scenario job on xenial for the
  # openstack-ansible repository if the branch is anything before ocata.
  - name: ^gate-openstack-ansible-openstack-ansible-aio-ubuntu-xenial$
    branch: ^(?!stable/newton).*$

  # Skip the OpenStack-Ansible Ceph job for the openstack-ansible repository if
  # the branch is anything before ocata.
  - name: ^gate-openstack-ansible-openstack-ansible-ceph-(centos-7|ubuntu-xenial).*$
    branch: ^(?!stable/newton).*$

  # Skip the OpenStack-Ansible Octavia job for the openstack-ansible repository if
  # the branch is anything before pike.
  - name: ^gate-openstack-ansible-openstack-ansible-octavia-(centos-7|ubuntu-xenial).*$
    branch: ^(?!stable/newton|ocata).*$

  # Skip the OpenStack-Ansible CentOS job for the openstack-ansible repository if
  # the branch is anything before ocata.
  - name: ^gate-openstack-ansible-openstack-ansible-aio-centos-7.*$
    branch: ^(?!stable/newton).*$

  # Skip the os_ceilometer functional tests against gnocchi on Newton
  # and earlier branches.
  - name: ^gate-openstack-ansible-os_ceilometer-ansible-gnocchi.*$
    branch: ^(?!stable/newton).*$

  # Skip the os_neutron functional tests for calico/dragonflow on Newton
  # and earlier branches.
  - name: ^gate-openstack-ansible-os_neutron-ansible-(calico|dragonflow).*$
    branch: ^(?!stable/newton).*$

  # Skip the upgrade test on Newton and earlier branches.
  - name: ^gate-openstack-ansible-.*-ansible-upgrade.*$
    branch: ^(?!stable/newton).*$

  # Skip galera_ssl test on Ocata and earlier branches
  - name: ^gate-openstack-ansible-galera_server-ansible-ssl.*$
    branch: ^(?!stable/newton|ocata).*$

  # Skip galera_server upgrade scenario on Pike and earlier branches
  - name: ^gate-openstack-ansible-galera_server-ansible-upgrade.*$
    branch: ^(?!stable/(newton|ocata)).*$

  # Ignore requirements on the keystoneclient/keystoneauth integration branch
  - name: gate-python-keystoneclient-requirements
    branch: ^(?!feature/keystoneauth_integration).*$

  - name: ^gate-sahara-cli.*$
    skip-if:
      - project: ^openstack/sahara-tests$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^releasenotes/.*$
          - ^etc/.*$
          - ^sahara_tests/.*$
          - ^sahara_tempest_plugin/tests/api/.*$
          - ^tox.ini$

  # Only run the unit cross tests for cliff against master.
  - name: ^gate-cliff-tox-(openstackclient|neutronclient)-tip-ubuntu-xenial$
    branch: ^master$

  - name: ^gate-python-ironic-inspector-client-docs-ubuntu-xenial$
    branch: ^(?!stable/newton).*$

  # NOTE(vsaienko) Ironic multinode job is voting starting from Pike
  - name: ^gate-tempest-dsvm-ironic-ipa-wholedisk-agent_ipmitool-tinyipa-multinode-ubuntu-xenial$
    branch: ^(?!stable/(newton|ocata)).*$

  # NOTE(vsaienko) Ironic multinode-nv job launched only on Newton and Ocata
  - name: ^gate-tempest-dsvm-ironic-ipa-wholedisk-agent_ipmitool-tinyipa-multinode-ubuntu-xenial-nv$
    branch: ^stable/(newton|ocata).*$

  # NOTE(vsaienko) Ironic multitenant job launched only on Newton and Ocata, for Pike+ it replaced
  # by multitenant-multinode.
  - name: ^gate-tempest-dsvm-ironic-multitenant-network-ubuntu-xenial$
    branch: ^stable/(newton|ocata).*$

  # NOTE(vsaienko) Ironic snmp job do not work until after Ocata
  - name: ^gate-tempest-dsvm-ironic-ipa-wholedisk-bios-pxe_snmp-tinyipa-ubuntu-xenial.*$
    branch: ^(?!stable/newton).*$

  # Skip the following jobs on ironic project starting from Pike, as we test the as part of ironic-standalone:
  #   * gate-tempest-dsvm-ironic-ipa-wholedisk-bios-pxe_ipmitool-tinyipa-ubuntu-xenial
  #   * gate-tempest-dsvm-ironic-ipa-partition-bios-agent_ipmitool-tinyipa-ubuntu-xenial
  #   * gate-tempest-dsvm-ironic-ipa-partition-bios-pxe_ipmitool-tinyipa-ubuntu-xenial
  # NOTE(vsaienko): we still keep gate-tempest-dsvm-ironic-ipa-wholedisk-bios-agent_ipmitool-tinyipa-ubuntu-xenial
  #                 as it is integrated job and launched on devstack/nova/neutron/ironic projects
  #                 Might be replaced by multinode job in future.
  - name: ^gate-tempest-dsvm-ironic-ipa-partition-bios-(pxe|agent)_ipmitool-tinyipa-ubuntu-xenial$
    branch: ^stable/(newton|ocata).*$

  - name: ^gate-tempest-dsvm-ironic-ipa-wholedisk-bios-pxe_ipmitool-tinyipa-ubuntu-xenial$
    branch: ^stable/(newton|ocata).*$

  # Only run the redfish job(s) against pike+
  - name: ^gate-tempest-dsvm-ironic-ipa-(partition|wholedisk)-redfish-tinyipa-ubuntu-xenial.*$
    branch: ^(?!stable/(newton|ocata)).*$

  # Only run the Boot-From-Volume (BFV) job starting in Pike
  - name: ^gate-tempest-dsvm-ironic-bfv-ubuntu-xenial.*$
    branch: ^(?!stable/(newton|ocata)).*$

  # Run the python35 functional job starting in Pike
  - name: ^gate-tempest-dsvm-ironic-ipa-partition-pxe_ipmitool-tinyipa-python3-ubuntu-xenial.*$
    branch: ^(?!stable/(newton|ocata)).*$

  - name: ^gate-senlin-dsvm-tempest-(py27|py35)-(functional|api|integration)
    skip-if:
      - project: ^openstack/senlin$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*$
          - ^api-ref/.*$
          - ^releasenotes/.*$

  - name: ^gate-senlin-dsvm-tempest-py35-(functional|api|integration)
    branch: ^(?!stable/newton).*$

  # Skip non-doc jobs for doc-only patrole changes.
  - name: ^gate-.*patrole-.*(admin|member|python27|python35|py35).*$
    skip-if:
      - project: ^openstack/patrole.*$
        all-files-match-any:
          - ^.*\.rst$
          - ^doc/.*
          - ^releasenotes/.*

  # Skip integration jobs for unit test-only patrole changes. All integration
  # jobs prefixed with "gate-tempest-dsvm-patrole".
  - name: ^gate-tempest-dsvm-patrole.*$
    skip-if:
      - project: ^openstack/patrole.*$
        all-files-match-any:
          - ^patrole/patrole_tempest_plugin/tests/unit/.*$

  # NOTE(andrey-mp): nova-network is deprecated since Ocata
  - name: gate-functional-nova-network-dsvm-ec2api-ubuntu-xenial
    branch: ^stable/newton$

  # NOTE(andrey-mp): nova-network is deprecated since Ocata
  - name: gate-functional-nova-network-dsvm-gceapi-ubuntu-xenial-nv
    branch: ^stable/newton$

  - name: ^gate-.*-releasenotes$
    success-pattern: http://docs-draft.openstack.org/{build.parameters[LOG_PATH]}/releasenotes/build/html/
    files:
      - '^releasenotes/.*'
      - '^tox.ini'
      - '^.*requirements.txt$'

  # Some python client projects do not have releasenotes until the Ocata cycle
  - name: ^gate-python-(freezer|tripleo|zaqar)client-releasenotes$
    branch: ^(?!stable/newton).*$

  # Some projects do not have releasenotes until the Ocata cycle
  - name: ^gate-(automaton|ceilometermiddleware|cloudkitty|cloudkitty-dashboard|debtcollector|freezer|freezer-api|futurist|instack.*|kuryr|kuryr-libnetwork|networking-sfc|osprofiler|oslo.(i18n|middleware|reports|serialization|utils|versionedobjects)|oslosphinx|oslotest|puppet-tripleo|stevedore|swift|taskflow|tooz|tripleo.*)-releasenotes$
    branch: ^(?!stable/newton).*$

  # Some projects do not have releasenotes until the Queens cycle
  - name: ^gate-(castellan)-releasenotes$
    branch: ^(?!stable/(newton|ocata|pike)).*$

  # Some python client projects do not have releasenotes tox envs until the Queens cycle
  - name: ^gate-python-(swift)client-releasenotes$
    branch: ^(?!stable/(newton|ocata|pike)).*$

  - name: gate-python-fuelclient-python34
    branch: ^stable/8\.0.*$

  - name: ^gate-python-fuelclient-python27-ubuntu-trusty
    branch: ^(stable/(7\.0|8\.0)).*$

  - name: ^gate-python-fuelclient-python27-ubuntu-xenial
    branch: ^(?!stable/(?:6\.1|7\.0|8\.0)).*$

  - name: ^gate-tooz-tox-py35-.+-ubuntu-xenial
    branch: ^(?!stable/newton).*$

  # NOTE(dims) etcd3 and etcd3gw is available only in pike and forward
  - name: ^gate-tooz-tox-.*-etcd3.*-ubuntu-xenial$
    branch: ^(?!stable/(newton|ocata)).*$

    # Requirements project publishes documents from master only.
  - name: ^(?:gate-)requirements-docs-ubuntu-xenial$
    branch: master

  - name: gate-heat-translator-tox-py27-tp-ubuntu-xenial
    branch: master
    voting: false

  # Make sure we do not match openstack-ansible jobs, as they have their own
  # rules.
  - name: ^gate-(?!openstack-ansible).*(-dsvm)?-ansible-func-ubuntu-trusty(-nv)?$
    branch: master

  - name: ^gate-fuel-octane-puppet.*$
    branch: ^(?!stable/(6.[01]|[78].0)).*$

  - name: ^fuel-octane-coverage-ubuntu-trusty.*$
    branch: ^stable/[87]\.0.*$

  - name: ^fuel-octane-coverage-ubuntu-xenial.*$
    branch: ^(?!stable/(?:[456]\.[01]|[78]\.0)).*$

  - name: gate-fuel-ccp-validate
    queue-name: fuel-ccp

  # Don't run Python 3.5 checks against older nova-lxd releases
  # as a) they don't have the right tox targets a b) no one
  # is actually going to use them with this python version.
  - name: ^gate-nova-lxd-python35$
    branch: ^(?!stable/(newton|ocata)).*$

  # Don't run nova-lxd dsvm gate checks on newton or older
  # Older nova-lxd versions did not use os-vif, and as a result have
  # somewhat un-reliable network vif plugging.
  - name: ^gate-tempest-dsvm-lxd-.*$
    branch: ^(?!stable/newton).*$

  # Only run nova-tox-functional-py35-ubuntu tests on branch master
  # TODO(gcb): run these tests on future stable branches starting with pike.
  - name: ^gate-nova-tox-functional-py35-ubuntu-xenial
    branch: master

  # NOTE(mriedem): The nova-next job runs placement + cells v2 + neutron
  # which were all optional in newton but are defaults in ocata+. In Pike we
  # made the job run with send_service_user_token so we want to run against
  # stable/newton and Pike (current master), but skip stable/ocata.
  - name: gate-tempest-dsvm-neutron-nova-next-full-ubuntu-xenial-nv
    branch: ^(stable/newton|master)$

  - name: ^gate-swift3-tox-s3tests_
    voting: false

  # Note(chandankumar): Tempest plugin sanity gate should be
  # non-voting until we fix all the tempest plugins issue.
  - name: gate-tempest-tox-plugin-sanity-check-ubuntu-xenial
    voting: false

  # Trusty job needs to run on master as well for now since
  # storyboard is deployed currently on trusty from master.
  - name: gate-storyboard-js-integration-ubuntu-trusty
    branch: ^master$

  # Disable python27 devstack tests on the feature/zuulv3 branch of nodepool
  - name: ^gate-dsvm-nodepool(-src)?-nv$
    branch: ^(?!feature/zuulv3).*$

  # Only run python27 job on the master branch of zuul
  - name: ^gate-zuul-python27
    branch: master

  # Only run python35 job on the feature/zuulv3 branch of zuul
  - name: ^gate-zuul-python35
    branch: feature/zuulv3

  # Only run python27 job on the master branch of nodepool
  - name: ^gate-nodepool-python27
    branch: master

  # Only run python35 job on the feature/zuulv3 branch of nodepool
  - name: ^gate-nodepool-python35
    branch: feature/zuulv3

  # python3 is supported only in queens and forward
  - name: ^gate-vitrage-dsvm-api-py35-ubuntu-xenial
    branch: ^(?!stable/(newton|ocata|pike)).*$

  # python3 is supported only in queens and forward
  - name: ^gate-vitrage-dsvm-datasources-py35-ubuntu-xenial
    branch: ^(?!stable/(newton|ocata|pike)).*$

  # openSUSE became a voting job in Pike so skip it for older
  # releases
  - name: ^gate-bifrost-integration-tinyipa-opensuse-423$
    branch: ^(?!stable/(newton|ocata)).*$

  # tinyipa job do not pass on xenial on newton, so skip it
  - name: ^gate-bifrost-integration-tinyipa-ubuntu-xenial
    branch: ^(?!stable/newton).*$

########################################################################
# The project list is sorted alphabetically.
########################################################################

projects:
  - name: theopenlab/gophercloud
    template:
      - name: merge-check
      - name: noop-jobs

  - name: theopenlab/cicd
    template:
      - name: merge-check
      - name: noop-jobs